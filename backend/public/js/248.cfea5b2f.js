"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[248],{2248:function(e,t,n){n.r(t),n.d(t,{default:function(){return D}});var a=n(6768),i=n(5130),r=n(4232);const s={class:"add-ingredients-container"},l={class:"add-ingredients"},o={class:"input-container"},d=["disabled"],u=["disabled"],c=["disabled"],p=["disabled"],g={class:"search-container"},m={class:"upload-container"},y={key:0,class:"image-preview"},h=["src"],k=["disabled"],v={key:0,class:"analysis-results"},f={class:"analysis-grid"},L=["onUpdate:modelValue"],b=["onUpdate:modelValue"],C={key:0,class:"error-message"},w=["onUpdate:modelValue"],I={key:1,class:"ingredient-list"},q={class:"category-title"},E={class:"ingredient-info"},U={class:"ingredient-quantity"},Q={class:"ingredient-actions"},F=["onUpdate:modelValue"],$=["onClick"],A=["onClick"],V=["onClick"],X={key:2,class:"ingredient-list"},j={class:"ingredient-info"},R={class:"ingredient-quantity"},_={class:"ingredient-actions"},z=["onUpdate:modelValue"],S=["onClick"],B=["onClick"],J=["onClick"],N={key:3,class:"loading-spinner"};function x(e,t,n,x,M,K){return(0,a.uX)(),(0,a.CE)("div",s,[(0,a.Lk)("div",l,[t[14]||(t[14]=(0,a.Lk)("h4",null,"Ajouter des ingrédients :",-1)),(0,a.Lk)("div",o,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>M.newIngredient=e),placeholder:"Entrez un ingrédient ou un code-barre",disabled:M.isLoading},null,8,d),[[i.Jo,M.newIngredient]]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>M.newQuantity=e),type:"number",min:"1",placeholder:"Quantité",disabled:M.isLoading},null,8,u),[[i.Jo,M.newQuantity]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>M.newUnit=e),disabled:M.isLoading},t[9]||(t[9]=[(0,a.Fv)('<option value="" data-v-17938707>Unités (optionnel)</option><option value="g" data-v-17938707>g</option><option value="ml" data-v-17938707>ml</option><option value="kg" data-v-17938707>kg</option><option value="l" data-v-17938707>l</option>',5)]),8,c),[[i.u1,M.newUnit]]),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>K.addIngredient&&K.addIngredient(...e)),disabled:M.isLoading},"Ajouter",8,p)]),(0,a.Lk)("div",g,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>M.searchIngredient=e),placeholder:"Rechercher un ingrédient"},null,512),[[i.Jo,M.searchIngredient]]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>K.sortIngredientsByCategory&&K.sortIngredientsByCategory(...e)),class:"sort-button"},"Trier par catégorie")]),(0,a.Lk)("div",m,[t[10]||(t[10]=(0,a.Lk)("h5",null,"Uploader une photo :",-1)),(0,a.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>K.onFileChange&&K.onFileChange(...e)),accept:"image/*"},null,32),M.imageUrl?((0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("img",{src:M.imageUrl,alt:"Aperçu de l'image"},null,8,h)])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>K.analyzeImage&&K.analyzeImage(...e)),disabled:!M.imageFile||M.isLoading},"Analyser",8,k)]),M.analysisResult.length>0?((0,a.uX)(),(0,a.CE)("div",v,[t[13]||(t[13]=(0,a.Lk)("h5",null,"Résultats de l'analyse :",-1)),(0,a.Lk)("div",f,[t[12]||(t[12]=(0,a.Lk)("div",{class:"grid-header"},[(0,a.Lk)("span",null,"Sélection"),(0,a.Lk)("span",null,"Aliment"),(0,a.Lk)("span",null,"Probabilité"),(0,a.Lk)("span",null,"Quantité"),(0,a.Lk)("span",null,"Unités")],-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(M.analysisResult,((e,n)=>((0,a.uX)(),(0,a.CE)("div",{key:n,class:"grid-row"},[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.selected=t},null,8,L),[[i.lH,e.selected]]),(0,a.Lk)("span",null,(0,r.v_)(e.name),1),(0,a.Lk)("span",null,(0,r.v_)((100*e.probability).toFixed(2))+"%",1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.quantity=t,type:"number",min:"1",placeholder:"Quantité",class:(0,r.C4)(["quantity-input",{error:e.selected&&(!e.quantity||parseFloat(e.quantity)<=0)}])},null,10,b),[[i.Jo,e.quantity]]),M.errorMessage?((0,a.uX)(),(0,a.CE)("div",C,(0,r.v_)(M.errorMessage),1)):(0,a.Q3)("",!0),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.unit=t,class:"unit-select"},t[11]||(t[11]=[(0,a.Fv)('<option value="" data-v-17938707>Unités (optionnel)</option><option value="g" data-v-17938707>g</option><option value="ml" data-v-17938707>ml</option><option value="kg" data-v-17938707>kg</option><option value="l" data-v-17938707>l</option>',5)]),8,w),[[i.u1,e.unit]])])))),128))]),(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>K.validateSelection&&K.validateSelection(...e)),class:"validate-button"},"Valider")])):(0,a.Q3)("",!0),M.sortByCategory?((0,a.uX)(),(0,a.CE)("div",I,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(K.categorizedIngredients,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"category-group"},[(0,a.Lk)("h5",q,(0,r.v_)(t),1),(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,class:"ingredient-item"},[(0,a.Lk)("div",E,[(0,a.Lk)("strong",null,(0,r.v_)(e.name),1),(0,a.Lk)("div",U,(0,r.v_)(e.quantity),1)]),(0,a.Lk)("div",Q,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité"},null,8,F),[[i.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,a.Lk)("button",{onClick:n=>K.updateIngredientQuantity(t,e.name,e.updateQuantity,"add"),class:"add-button"},"Ajouter",8,$),(0,a.Lk)("button",{onClick:n=>K.updateIngredientQuantity(t,e.name,e.updateQuantity,"subtract"),class:"subtract-button"},"Soustraire",8,A),(0,a.Lk)("button",{onClick:n=>K.removeIngredient(t,e.name),class:"remove-button"},"Supprimer",8,V)])])))),128))])])))),128))])):((0,a.uX)(),(0,a.CE)("div",X,[(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(K.filteredIngredients,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t,class:"ingredient-item"},[(0,a.Lk)("div",j,[(0,a.Lk)("strong",null,(0,r.v_)(e.name),1),(0,a.Lk)("div",R,(0,r.v_)(e.quantity),1)]),(0,a.Lk)("div",_,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité"},null,8,z),[[i.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,a.Lk)("button",{onClick:n=>K.updateIngredientQuantity(t,e.name,e.updateQuantity,"add"),class:"add-button"},"Ajouter",8,S),(0,a.Lk)("button",{onClick:n=>K.updateIngredientQuantity(t,e.name,e.updateQuantity,"subtract"),class:"subtract-button"},"Soustraire",8,B),(0,a.Lk)("button",{onClick:n=>K.removeIngredient(t,e.name),class:"remove-button"},"Supprimer",8,J)])])))),128))])])),M.isLoading?((0,a.uX)(),(0,a.CE)("div",N,"Chargement...")):(0,a.Q3)("",!0)])])}n(4114),n(4603),n(7566),n(8721);var M=n(4373),K={name:"IngredientsPage.vue",data(){return{newIngredient:"",newQuantity:"",newUnit:"",searchIngredient:"",ingredients:[],imageFile:null,imageUrl:"",analysisResult:[],isLoading:!1,sortByCategory:!1,errorMessage:""}},computed:{filteredIngredients(){let e=this.ingredients;return""!==this.searchIngredient.trim()&&(e=e.filter((e=>e.name.toLowerCase().includes(this.searchIngredient.trim().toLowerCase())))),e},categorizedIngredients(){const e={};return this.filteredIngredients.forEach((t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)})),e}},created(){this.fetchIngredientsFromFridge()},methods:{onFileChange(e){const t=e.target.files[0];t&&(this.imageFile=t,this.imageUrl=URL.createObjectURL(t))},async analyzeImage(){if(!this.imageFile)return;const e=new FormData;e.append("image",this.imageFile);try{this.isLoading=!0;const t=await M.A.post("https://tfe-3483aa964321.herokuapp.com/users/analyzeImage",e,{headers:{"Content-Type":"multipart/form-data"}});t.data&&t.data.data?this.analysisResult=t.data.data.map((e=>({...e,selected:!1,quantity:"",unit:""}))):(this.analysisResult=[],alert("Aucun ingrédient trouvé dans l'image."))}catch(t){console.error("Erreur lors de l'analyse de l'image :",t),alert("Une erreur est survenue lors de l'analyse de l'image.")}finally{this.isLoading=!1}},async validateSelection(){const e=this.analysisResult.filter((e=>e.selected&&e.quantity)),t=e.filter((e=>!e.quantity||parseFloat(e.quantity)<=0));if(t.length>0)this.errorMessage="Veuillez indiquer une quantité valide pour tous les ingrédients sélectionnés.";else{this.errorMessage="";for(const t of e){const e=this.ingredients.findIndex((e=>e.name.toLowerCase()===t.name.toLowerCase()&&e.quantity.includes(t.unit)));if(-1!==e){const a=this.ingredients[e],i=a.quantity,r=i.match(/^([\d.]+)\s*(.*)$/);if(r){const a=parseFloat(r[1]),i=r[2],s=a+parseFloat(t.quantity);this.ingredients[e].quantity=`${s} ${i}`.trim();try{await M.A.put("https://tfe-3483aa964321.herokuapp.com/users/fridge/update",{foodName:t.name,quantity:s,unit:i},{withCredentials:!0})}catch(n){console.error(`Erreur lors de la mise à jour de ${t.name} dans la base de données :`,n)}}}else{this.ingredients.push({name:t.name,quantity:`${t.quantity} ${t.unit}`.trim(),category:"ajoutés",updateQuantity:0});try{await M.A.post("https://tfe-3483aa964321.herokuapp.com/users/fridge/add",{foodName:t.name,quantity:`${t.quantity} ${t.unit}`.trim()},{withCredentials:!0})}catch(n){console.error(`Erreur lors de l'ajout de ${t.name} dans la base de données :`,n)}}}this.analysisResult=[],this.$emit("ingredients-updated",this.ingredients)}},async fetchIngredientsFromFridge(){try{this.isLoading=!0;const e=await M.A.get("https://tfe-3483aa964321.herokuapp.com/users/fridge",{withCredentials:!0});this.ingredients=e.data.map((e=>({name:e.food_name,quantity:e.quantity,category:e.category||"autres",updateQuantity:0})))}catch(e){console.error("Erreur lors de la récupération des ingrédients :",e)}finally{this.isLoading=!1}},async addIngredient(){const e=this.newIngredient.trim();let t=e;if(t){const e=this.ingredients.findIndex((e=>e.name===t&&e.quantity.includes(this.newUnit)));if(-1!==e){const a=this.ingredients[e],i=a.quantity,r=i.match(/^([\d.]+)\s*(.*)$/);if(!r)return void alert("Impossible de traiter la quantité actuelle.");const s=parseFloat(r[1]),l=r[2],o=parseFloat(this.newQuantity)||1,d=s+o;try{const n=await M.A.put("https://tfe-3483aa964321.herokuapp.com/users/fridge/update",{foodName:t,quantity:d,unit:l},{withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${d} ${l}`.trim()}catch(n){return void console.error("Erreur lors de la mise à jour de l'aliment :",n)}}else try{const e=await M.A.post("https://tfe-3483aa964321.herokuapp.com/users/fridge/add",{foodName:t,quantity:`${this.newQuantity||1} ${this.newUnit}`.trim()},{withCredentials:!0});if(200!==e.status)throw new Error("Erreur lors de l'ajout de l'aliment dans le réfrigérateur de l'utilisateur.");await this.fetchIngredientsFromFridge()}catch(n){n.response&&404===n.response.status?alert("L'aliment n'est pas encore dans la base de données."):console.error("Erreur lors de l'ajout de l'aliment :",n)}}this.newIngredient="",this.newQuantity="",this.newUnit="",this.$emit("ingredients-updated",this.ingredients)},async updateIngredientQuantity(e,t,n,a){if(!n||n<=0)return void alert("Veuillez entrer une quantité valide.");const i=this.ingredients[e].quantity,r=i.match(/^([\d.]+)\s*(.*)$/);if(!r)return void alert("Impossible de traiter la quantité actuelle.");const s=parseFloat(r[1]),l=r[2];let o;if("add"===a)o=s+n;else if("subtract"===a&&(o=s-n,o<=0))return void alert("La quantité ne peut pas être inférieure ou égale à zéro.");try{const n=await M.A.put("https://tfe-3483aa964321.herokuapp.com/users/fridge/update",{foodName:t,quantity:o,unit:l},{withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${o} ${l}`.trim()}catch(d){console.error("Erreur lors de la mise à jour de l'aliment :",d)}},async removeIngredient(e,t){try{const n=await M.A.delete("https://tfe-3483aa964321.herokuapp.com/users/fridge/delete",{params:{foodName:t},withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la suppression de l'aliment du réfrigérateur de l'utilisateur.");this.ingredients.splice(e,1),this.$emit("ingredients-updated",this.ingredients)}catch(n){console.error("Erreur lors de la suppression de l'aliment :",n)}},sortIngredientsByCategory(){this.sortByCategory=!this.sortByCategory}}},P=n(1241);const T=(0,P.A)(K,[["render",x],["__scopeId","data-v-17938707"]]);var D=T}}]);
//# sourceMappingURL=248.cfea5b2f.js.map