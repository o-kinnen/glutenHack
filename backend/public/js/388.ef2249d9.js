"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[388],{3388:function(e,r,t){t.r(r),t.d(r,{default:function(){return x}});var n=t(6768),a=t(5130),s=t(4232);const l={class:"container"},o={class:"card p-4 text-white"},i={class:"camera-container d-flex flex-column justify-content-center align-items-center"},c={class:"d-flex justify-content-center align-items-center gap-2 mt-3"},u={key:0,class:"modal-overlay"},d={class:"modal-content"},m={key:0,class:"resultat"},p={key:0},v={key:1},h={key:2,class:"d-flex justify-content-center"},f=["src"],k={class:"source"},g=["href"];function w(e,r,t,w,b,y){return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",o,[r[11]||(r[11]=(0,n.Lk)("h1",null,"Analyser un aliment",-1)),r[12]||(r[12]=(0,n.Lk)("p",null,"Recherchez un aliment en entrant son code-barres pour savoir s'il est sûr pour vous.",-1)),(0,n.Lk)("div",i,[r[4]||(r[4]=(0,n.Lk)("video",{id:"scanner",class:"camera-feed"},null,-1)),(0,n.Lk)("button",{onClick:r[0]||(r[0]=(...e)=>y.activerScanner&&y.activerScanner(...e)),class:"btn btn-secondary mt-2"},"Scanner")]),(0,n.Lk)("div",c,[(0,n.bo)((0,n.Lk)("input",{type:"text",id:"codeBarreInput","onUpdate:modelValue":r[1]||(r[1]=e=>b.codeBarre=e),placeholder:"Code-barres",class:"form-control w-75"},null,512),[[a.Jo,b.codeBarre]]),(0,n.Lk)("button",{onClick:r[2]||(r[2]=(...e)=>y.verifierAliment&&y.verifierAliment(...e)),class:"btn btn-primary w-auto"},"Vérifier")]),b.showModal?((0,n.uX)(),(0,n.CE)("div",u,[(0,n.Lk)("div",d,[(0,n.Lk)("button",{class:"close-btn",onClick:r[3]||(r[3]=(...e)=>y.closeModal&&y.closeModal(...e))},"X"),null!==b.resultat?((0,n.uX)(),(0,n.CE)("div",m,[b.resultat.peutManger?((0,n.uX)(),(0,n.CE)("p",v,[r[7]||(r[7]=(0,n.eW)(" ✅ ")),(0,n.Lk)("strong",null,(0,s.v_)(b.resultat.nomAliment),1),r[8]||(r[8]=(0,n.eW)(" semble sûr pour vous. Aucun allergène de votre profil n'est mentionné. "))])):((0,n.uX)(),(0,n.CE)("p",p,[r[5]||(r[5]=(0,n.eW)(" ⚠️ ")),(0,n.Lk)("strong",null,(0,s.v_)(b.resultat.nomAliment),1),r[6]||(r[6]=(0,n.eW)(" contient des allergènes problématiques pour vous : ")),(0,n.Lk)("strong",null,(0,s.v_)(b.resultat.allergenesProbleme.join(", ")),1)])),b.resultat.imageUrl?((0,n.uX)(),(0,n.CE)("div",h,[(0,n.Lk)("img",{src:`${b.resultat.imageUrl}?t=${Date.now()}`,alt:"Photo de l'aliment",style:{"max-width":"200px",border:"1px solid #ccc"}},null,8,f)])):(0,n.Q3)("",!0),(0,n.Lk)("p",k,[(0,n.Lk)("small",null,[r[9]||(r[9]=(0,n.eW)("Les informations affichées proviennent de la base de données ")),(0,n.Lk)("a",{href:"https://world.openfoodfacts.org/product/"+b.codeBarre,target:"_blank",class:"text-white"},"OpenFoodFacts",8,g),r[10]||(r[10]=(0,n.eW)("."))])])])):(0,n.Q3)("",!0)])])):(0,n.Q3)("",!0)])])}var b=t(4373),y=t(2295),L={name:"AnalysePage",data(){return{codeBarre:"",resultat:null,scanner:null,scannerActive:!1,showModal:!1}},methods:{async getUserRestrictions(){try{const e=await b.A.get("https://www.cookaller.com/users/restrictions",{withCredentials:!0});return(e.data.restrictions||[]).map((e=>e.toLowerCase()))}catch(e){return console.error("Erreur lors de la récupération des restrictions alimentaires :",e),alert("Impossible de récupérer les restrictions alimentaires. Veuillez réessayer."),[]}},async verifierAliment(){const e=this.codeBarre?this.codeBarre.trim():"";if(e)try{const r=await b.A.get("https://www.cookaller.com/api/food",{params:{codeBarre:e}}),t=r.data.allergenes||[],n=r.data.barcode_name||"Nom inconnu",a=r.data.imageUrl||"",s=r.data.source||"",l=await this.getUserRestrictions(),o=t.filter((e=>l.includes(e.toLowerCase())));this.resultat={nomAliment:n,imageUrl:a,allergenes:t,peutManger:0===o.length,allergenesProbleme:o,source:s},setTimeout((()=>{this.resultat.imageUrl+=`?t=${Date.now()}`}),1e3),this.showModal=!0}catch(r){console.error("Erreur lors de la vérification de l'aliment :",r),alert("Une erreur est survenue lors de la vérification. Veuillez réessayer.")}else alert("Veuillez entrer un code-barre.")},closeModal(){this.showModal=!1},async activerScanner(){try{this.scanner=new y.sx;const e={video:{facingMode:{exact:"environment"}}},r=document.getElementById("scanner"),t=await this.scanner.decodeOnceFromVideoDevice(null,r,e);t&&(this.codeBarre=t.text,this.verifierAliment())}catch(e){console.error("Erreur lors de l'activation du scanner :",e),alert("Impossible d'accéder à la caméra. Veuillez vérifier les permissions.")}}}},C=t(1241);const A=(0,C.A)(L,[["render",w],["__scopeId","data-v-1c0ba308"]]);var x=A}}]);
//# sourceMappingURL=388.ef2249d9.js.map