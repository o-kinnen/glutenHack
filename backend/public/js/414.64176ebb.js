"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[414],{1695:function(e,t,i){i.r(t),i.d(t,{default:function(){return ce}});var r=i(6768),s=i(4232),l=i(5130);const n={class:"container"},c={class:"card p-4 text-white"},a={key:0,class:"no-recipes"},o={key:1,class:"buttons-container"},u={key:2,class:"modal-overlay"},p={class:"modal-content"},d={class:"modal-filters"},h={class:"filter-item"},g={class:"filter-item"},m={class:"filter-item"},k={class:"filter-item"},v={class:"filter-item"},f={class:"filter-item"},L={class:"filter-item"},R={class:"filter-item"},w={class:"filter-item"},y={class:"filter-item"},_={class:"modal-actions"},b={key:3,class:"no-recipes"},E={key:4,class:"no-recipes"},A={key:5,class:"recipes-list"},C={key:0,class:"favorite-icon"},F=["src"],x=["onClick"],I={key:2,class:"attention-warning"},M={key:6,class:"modal-overlay"},P={class:"modal-content-recipe"},U={style:{"text-align":"center"}},X=["src"],S={class:"recipe-info-container"},j={class:"recipe-info-line"},W={class:"info-item"},T={class:"info-item"},V={class:"info-item"},D={class:"recipe-info-line"},z={class:"info-item"},H={class:"info-item"},$={class:"info-item"},Q={key:0},N=["src","alt","title"],O={key:1},K={key:1,style:{"text-align":"center"}},G={key:2,style:{"text-align":"center"}},q={class:"average-rating"},J={class:"rating-container"},B={class:"stars"},Y=["onClick"],Z={class:"modal-actions-icons"};function ee(e,t,i,ee,te,ie){const re=(0,r.g2)("EditRecipe");return(0,r.uX)(),(0,r.CE)("div",n,[(0,r.Lk)("div",c,[t[54]||(t[54]=(0,r.Lk)("h2",null,"Mes recettes",-1)),0===te.recipes.length?((0,r.uX)(),(0,r.CE)("div",a,t[22]||(t[22]=[(0,r.Lk)("p",null,"Aucune recette n'a été enregistrée pour le moment...",-1)]))):((0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=e=>te.showFilterModal=!0),class:"filter-button"}," Allergènes "),(0,r.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>ie.toggleFavorites&&ie.toggleFavorites(...e))},(0,s.v_)(te.showFavorites?"Toutes les recettes":"Favoris"),1),(0,r.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>ie.toggleProfileFilter&&ie.toggleProfileFilter(...e)),class:(0,s.C4)(["profile-button",{active:te.showProfileFilter}])},(0,s.v_)(te.showProfileFilter?"Toutes les recettes":"Mon profil"),3)])),te.showFilterModal?((0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("div",p,[(0,r.Lk)("div",d,[(0,r.Lk)("div",h,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Gluten","onUpdate:modelValue":t[3]||(t[3]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[23]||(t[23]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/gluten.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Gluten ")],-1))])]),(0,r.Lk)("div",g,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Lait","onUpdate:modelValue":t[4]||(t[4]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[24]||(t[24]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/lait.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Lait ")],-1))])]),(0,r.Lk)("div",m,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Oeufs","onUpdate:modelValue":t[5]||(t[5]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[25]||(t[25]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/oeufs.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Oeufs ")],-1))])]),(0,r.Lk)("div",k,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Arachide","onUpdate:modelValue":t[6]||(t[6]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[26]||(t[26]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/arachide.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Arachide ")],-1))])]),(0,r.Lk)("div",v,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Fruits à coque","onUpdate:modelValue":t[7]||(t[7]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[27]||(t[27]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/noix.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Noix ")],-1))])]),(0,r.Lk)("div",f,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Poissons","onUpdate:modelValue":t[8]||(t[8]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[28]||(t[28]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/poissons.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Poissons ")],-1))])]),(0,r.Lk)("div",L,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Soja","onUpdate:modelValue":t[9]||(t[9]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[29]||(t[29]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/soja.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Soja ")],-1))])]),(0,r.Lk)("div",R,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Crustacés","onUpdate:modelValue":t[10]||(t[10]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[30]||(t[30]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/crustacés.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Crustacés ")],-1))])]),(0,r.Lk)("div",w,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Moutarde","onUpdate:modelValue":t[11]||(t[11]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[31]||(t[31]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/moutarde.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Moutarde ")],-1))])]),(0,r.Lk)("div",y,[(0,r.Lk)("label",null,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:"Céleri","onUpdate:modelValue":t[12]||(t[12]=e=>te.selectedAllergens=e)},null,512),[[l.lH,te.selectedAllergens]]),t[32]||(t[32]=(0,r.Lk)("span",{class:"text-and-icon"},[(0,r.Lk)("img",{src:"/img/céleri.png",alt:"Icone",class:"restriction-icon"}),(0,r.eW)(" Céleri ")],-1))])])]),(0,r.Lk)("div",_,[(0,r.Lk)("button",{onClick:t[13]||(t[13]=e=>te.showFilterModal=!1),class:"close-button"},"Fermer")])])])):(0,r.Q3)("",!0),te.showProfileFilter&&0===te.userAllergens.length?((0,r.uX)(),(0,r.CE)("div",b,t[33]||(t[33]=[(0,r.Lk)("p",null,"Seules les recettes sans mention d'allergènes sont affichées car vous n'avez spécifié aucun allergène dans votre profil.",-1)]))):(0,r.Q3)("",!0),te.showFavorites&&0===te.filteredRecipes.length||0===te.filteredRecipes.length&&0!==te.recipes.length?((0,r.uX)(),(0,r.CE)("div",E,t[34]||(t[34]=[(0,r.Lk)("p",null,"Aucune recette trouvée.",-1)]))):((0,r.uX)(),(0,r.CE)("div",A,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(te.filteredRecipes,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.recipe_id,class:"recipe-card"},[(0,r.Lk)("h3",null,(0,s.v_)(e.recipe_name),1),e.isFavorite?((0,r.uX)(),(0,r.CE)("div",C,t[35]||(t[35]=[(0,r.Lk)("i",{class:"bi bi-heart-fill",style:{color:"red"}},null,-1)]))):(0,r.Q3)("",!0),e.image_url?((0,r.uX)(),(0,r.CE)("img",{key:1,src:e.image_url?e.image_url:"/img/food.png",alt:"Image de la recette",class:"modal-recipe-image",onError:t[14]||(t[14]=e=>ie.handleImageError(e))},null,40,F)):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:t=>ie.openModal(e)},"Voir les détails",8,x),ie.getMissingAllergens(e).length>0?((0,r.uX)(),(0,r.CE)("div",I,[t[38]||(t[38]=(0,r.Lk)("i",{class:"bi bi-exclamation-triangle-fill"},null,-1)),(0,r.Lk)("p",null,[t[36]||(t[36]=(0,r.eW)(" Ces allergènes ne sont pas pris en compte dans cette recette : ")),(0,r.Lk)("strong",null,(0,s.v_)(ie.getMissingAllergens(e).join(", ")),1),t[37]||(t[37]=(0,r.eW)(". "))])])):(0,r.Q3)("",!0)])))),128))])),te.showModal?((0,r.uX)(),(0,r.CE)("div",M,[(0,r.Lk)("div",P,[(0,r.Lk)("h3",U,(0,s.v_)(te.currentRecipe.recipe_name),1),te.currentRecipe.image_url?((0,r.uX)(),(0,r.CE)("img",{key:0,src:te.currentRecipe.image_url?te.currentRecipe.image_url:"/img/food.png",alt:"Image de la recette",class:"recipe-image",onError:t[15]||(t[15]=e=>ie.handleImageError(e))},null,40,X)):(0,r.Q3)("",!0),(0,r.Lk)("div",S,[(0,r.Lk)("div",j,[(0,r.Lk)("div",W,[t[39]||(t[39]=(0,r.Lk)("strong",null,"Préparation:",-1)),t[40]||(t[40]=(0,r.Lk)("br",null,null,-1)),(0,r.eW)(" "+(0,s.v_)(te.currentRecipe.preparation_time),1)]),(0,r.Lk)("div",T,[t[41]||(t[41]=(0,r.Lk)("strong",null,"Difficulté:",-1)),t[42]||(t[42]=(0,r.Lk)("br",null,null,-1)),(0,r.eW)(" "+(0,s.v_)(te.currentRecipe.difficulty),1)]),(0,r.Lk)("div",V,[t[43]||(t[43]=(0,r.Lk)("strong",null,"Part(s):",-1)),t[44]||(t[44]=(0,r.Lk)("br",null,null,-1)),(0,r.eW)(" "+(0,s.v_)(te.currentRecipe.number_of_person),1)])]),(0,r.Lk)("div",D,[(0,r.Lk)("div",z,[t[45]||(t[45]=(0,r.Lk)("strong",null,"Cuisine:",-1)),t[46]||(t[46]=(0,r.Lk)("br",null,null,-1)),(0,r.eW)(" "+(0,s.v_)(te.currentRecipe.cuisine_type),1)]),(0,r.Lk)("div",H,[t[47]||(t[47]=(0,r.Lk)("strong",null,"Type:",-1)),t[48]||(t[48]=(0,r.Lk)("br",null,null,-1)),(0,r.eW)(" "+(0,s.v_)(te.currentRecipe.category_type),1)]),(0,r.Lk)("div",$,[t[49]||(t[49]=(0,r.Lk)("strong",null,"Sans allergène :",-1)),t[50]||(t[50]=(0,r.Lk)("br",null,null,-1)),te.currentRecipe.allergens_list?.length?((0,r.uX)(),(0,r.CE)("span",Q,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(te.currentRecipe.allergens_list,((e,t)=>((0,r.uX)(),(0,r.CE)("img",{key:t,src:ie.getAllergenIcon(e),alt:e,title:e,class:"allergen-icon"},null,8,N)))),128))])):((0,r.uX)(),(0,r.CE)("span",O,"Pas de mention"))])])]),t[52]||(t[52]=(0,r.Lk)("h4",null,"Ingrédients",-1)),(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(te.currentRecipe.ingredients,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:t},(0,s.v_)(e.quantity)+" "+(0,s.v_)(e.food_name),1)))),128))]),t[53]||(t[53]=(0,r.Lk)("h4",null,"Instructions",-1)),(0,r.Lk)("ol",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(ie.formattedInstructionsArray,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:t},(0,s.v_)(e),1)))),128))]),0===te.currentRecipe.averageRating?((0,r.uX)(),(0,r.CE)("p",K,"Cette recette n'a pas encore été notée.")):((0,r.uX)(),(0,r.CE)("p",G,"Voici la note reçue de la recette.")),(0,r.Lk)("div",q,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(5,(e=>(0,r.Lk)("span",{key:e,class:(0,s.C4)(["star",{filled:e<=te.currentRecipe.averageRating}])}," ★ ",2))),64))]),(0,r.Lk)("div",J,[t[51]||(t[51]=(0,r.Lk)("p",{style:{"text-align":"center"}},"Noter la recette ?",-1)),(0,r.Lk)("div",B,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(5,(e=>(0,r.Lk)("span",{key:e,class:(0,s.C4)(["star",{filled:e<=te.currentRecipe.rating}]),onClick:t=>ie.rateRecipe(e)}," ★ ",10,Y))),64))])]),(0,r.Lk)("div",Z,[(0,r.Lk)("i",{class:(0,s.C4)(["bi bi-heart-fill icon-action",{active:te.isFavorite}]),onClick:t[16]||(t[16]=e=>te.isFavorite?ie.removeFromFavorites():ie.addToFavorites()),title:"Ajouter/Retirer des favoris"},null,2),(0,r.Lk)("i",{class:"bi bi-cart-fill icon-action",onClick:t[17]||(t[17]=(...e)=>ie.addToShoppingList&&ie.addToShoppingList(...e)),title:"Ajouter à la liste des courses"}),(0,r.Lk)("i",{class:"bi bi-file-earmark-pdf-fill icon-action",onClick:t[18]||(t[18]=(...e)=>ie.generatePDF&&ie.generatePDF(...e)),title:"Exporter en PDF"}),(0,r.Lk)("i",{class:"bi bi-pencil icon-action",onClick:t[19]||(t[19]=e=>ie.openEditModal(te.currentRecipe)),title:"Modifier"}),(0,r.Lk)("i",{class:"bi bi-trash icon-action",onClick:t[20]||(t[20]=(...e)=>ie.confirmDeleteRecipe&&ie.confirmDeleteRecipe(...e)),title:"Suppimer"}),(0,r.Lk)("i",{class:"bi bi-x-lg icon-action",onClick:t[21]||(t[21]=(...e)=>ie.closeModal&&ie.closeModal(...e)),title:"Fermer"})])])])):(0,r.Q3)("",!0),te.showEditModal?((0,r.uX)(),(0,r.Wv)(re,{key:7,mode:"edit",isVisible:te.showEditModal,onClose:ie.closeEditModal,onUpdateRecipe:ie.handleUpdateRecipe,recipe:te.currentRecipe},null,8,["isVisible","onClose","onUpdateRecipe","recipe"])):(0,r.Q3)("",!0)])])}var te=i(4373),ie=i(8437),re=i(1749),se={name:"MyRecipesPage",components:{EditRecipe:ie.A},data(){return{recipes:[],userAllergens:[],filteredRecipes:[],selectedAllergens:[],showModal:!1,showEditModal:!1,showProfileFilter:!1,currentRecipe:null,errorMessage:"",isFavorite:!1,showFavorites:!1,showFilterModal:!1}},computed:{formattedInstructionsArray(){return this.currentRecipe?.instructions?"string"===typeof this.currentRecipe.instructions?this.currentRecipe.instructions.split("\n").filter((e=>""!==e.trim())):Array.isArray(this.currentRecipe.instructions)?this.currentRecipe.instructions.map((e=>"object"===typeof e?e.step:e)):[]:[]}},methods:{handleError(e,t){this.errorMessage=t},toggleFavorites(){this.showFavorites=!this.showFavorites,this.filterRecipes()},toggleProfileFilter(){this.showProfileFilter=!this.showProfileFilter,this.filterRecipes()},handleImageError(e){e.target.src="/img/food.png"},getAllergenIcon(e){const t={Gluten:"/img/gluten.png",Lait:"/img/lait.png",Oeufs:"/img/oeufs.png",Arachide:"/img/arachide.png",Noix:"/img/noix.png",Poissons:"/img/poissons.png",Soja:"/img/soja.png","Crustacés":"/img/crustacés.png",Moutarde:"/img/moutarde.png","Céleri":"/img/céleri.png"};return t[e]||"/img/plat.png"},filterRecipes(){this.filteredRecipes=this.recipes.map((e=>({...e,image_url:e.image_url||"/img/food.png"}))).filter((e=>{const t=!this.showFavorites||e.isFavorite,i=this.selectedAllergens.every((t=>e.allergens_list?.includes(t))),r=!this.showProfileFilter||(0===this.userAllergens.length?!e.allergens_list||0===e.allergens_list.length||e.allergens_list.includes("Pas de mention"):this.userAllergens.every((t=>e.allergens_list?.includes(t))));return t&&i&&r}))},async convertImageToBase64(e){return new Promise(((t,i)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0),t(e.toDataURL("image/png"))},r.onerror=e=>i(e),r.src=e}))},async generatePDF(){if(!this.currentRecipe)return void alert("Aucune recette sélectionnée pour générer le PDF.");const e=new re.uE,t=e.internal.pageSize.width,i=e.internal.pageSize.height,r=10;let s=r;const l=(t=10)=>{s+t>i-r&&(e.addPage(),s=r)};e.setFontSize(18),e.setFont("helvetica","bold");const n=this.currentRecipe.recipe_name,c=e.getTextWidth(n);e.text(n,(t-c)/2,s),s+=20;const a=[{label:"Préparation:",value:this.currentRecipe.preparation_time},{label:"Difficulté:",value:this.currentRecipe.difficulty},{label:"Part(s):",value:this.currentRecipe.number_of_person},{label:"Cuisine:",value:this.currentRecipe.cuisine_type},{label:"Type:",value:this.currentRecipe.category_type},{label:"Sans allergène:",value:this.currentRecipe.allergens_list?.length?this.currentRecipe.allergens_list.join(", "):"Aucun allergène spécifié."}],o=(t-2*r)/3,u=r,p=u+o,d=p+o;if(e.setFontSize(12),e.setFont("helvetica","normal"),a.forEach(((t,i)=>{const r=i%3,n=Math.floor(i/3),c=0===r?u:1===r?p:d,a=s+10*n;l(10),e.text(t.label,c,a),e.text(t.value,c+30,a)})),s+=10*Math.ceil(a.length/3)+10,this.currentRecipe.image_url)try{const i=await this.convertImageToBase64(this.currentRecipe.image_url);l(90),e.addImage(i,"PNG",(t-80)/2,s,80,80),s+=90}catch(g){this.handleError(g,"Erreur lors du chargement de l'image")}e.setFontSize(14),e.text("Ingrédients:",10,s),s+=10,e.setFontSize(12),this.currentRecipe.ingredients.forEach((t=>{e.text(`${t.quantity} ${t.food_name}`,10,s),s+=10})),e.setFontSize(14),e.text("Instructions:",10,s),s+=10,e.setFontSize(12);const h=10;this.formattedInstructionsArray.forEach(((t,i)=>{const r=e.splitTextToSize(`${i+1}. ${t}`,190);r.forEach((t=>{l(h),e.text(t,10,s),s+=h}))})),e.save(`${this.currentRecipe.recipe_name}.pdf`)},async rateRecipe(e){try{if(!this.currentRecipe?.recipe_id)throw new Error("Aucune recette sélectionnée.");await te.A.post("https://www.cookaller.com/recipes/rate",{recipeId:this.currentRecipe.recipe_id,rating:e},{withCredentials:!0}),this.currentRecipe.rating=e,await this.fetchAverageRating(this.currentRecipe.recipe_id)}catch(t){this.handleError(t,"Erreur lors de l'envoi de la note"),alert("Une erreur est survenue lors de l'enregistrement de la note.")}},async fetchAverageRating(e){try{const t=await te.A.get(`https://www.cookaller.com/recipes/rate/average/${e}`,{withCredentials:!0});this.currentRecipe.averageRating=parseFloat(t.data.averageRating)||0}catch(t){this.handleError(t,"Erreur lors de la récupération de la moyenne des notes :"),this.currentRecipe&&(this.currentRecipe.averageRating=0),alert("Impossible de récupérer la moyenne des notes.")}},async fetchUserRecipes(){try{const e=await te.A.get("https://www.cookaller.com/recipes/user",{withCredentials:!0}),t=await te.A.get("https://www.cookaller.com/recipes/favorites",{withCredentials:!0}),i=t.data.map((e=>e.recipe_id));this.recipes=e.data.map((e=>({...e,isFavorite:i.includes(e.recipe_id)}))),this.filterRecipes()}catch(e){e.response&&404===e.response.status?(this.recipes=[],this.filterRecipes()):this.handleError(e,"Erreur lors de la récupération des recettes utilisateur.")}},async loadUserAllergens(){this.userAllergens=await this.fetchUserAllergens()},async fetchUserAllergens(){try{const e=await te.A.get("https://www.cookaller.com/users/restrictions",{withCredentials:!0});return e.data.restrictions||[]}catch(e){return this.handleError(e,"Erreur lors de la récupération des restrictions alimentaires :"),alert("Impossible de récupérer les restrictions alimentaires. Veuillez réessayer."),[]}},getMissingAllergens(e){return this.userAllergens.length?e.allergens_list?this.userAllergens.filter((t=>!e.allergens_list.includes(t))):[...this.userAllergens]:[]},async addToShoppingList(){try{const e=await te.A.post("https://www.cookaller.com/shopping-list/add",{recipeId:this.currentRecipe.recipe_id},{withCredentials:!0});alert(e.data.message)}catch(e){this.handleError(e,"Erreur lors de l'ajout à la liste des courses:"),alert("Une erreur est survenue.")}},async deleteRecipe(){try{await te.A.delete(`https://www.cookaller.com/recipes/${this.currentRecipe.recipe_id}`,{withCredentials:!0}),alert("Recette supprimée avec succès."),this.recipes=this.recipes.filter((e=>e.recipe_id!==this.currentRecipe.recipe_id)),this.filterRecipes(),this.closeModal()}catch(e){this.handleError(e,"Erreur lors de la suppression de la recette :"),alert("Une erreur est survenue lors de la suppression.")}},async handleUpdateRecipe(e){try{const t=new FormData;t.append("title",e.recipe_name),t.append("time",e.preparation_time),t.append("difficulty",e.difficulty),t.append("people",e.number_of_person),t.append("cuisine",e.cuisine_type),t.append("type",e.category_type),t.append("public",e.public),t.append("ingredients",JSON.stringify(e.ingredients)),t.append("instructions",JSON.stringify(e.instructions)),t.append("restrictionsList",JSON.stringify(e.allergens_list)),e.image&&t.append("image",e.image);const i=await te.A.put(`https://www.cookaller.com/recipes/update/${e.recipe_id}`,t,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});if(200===i.status){alert("Recette mise à jour avec succès"),e.image_url=i.data.updatedRecipe.image_url;const t=this.recipes.findIndex((t=>t.recipe_id===e.recipe_id));-1!==t&&(this.recipes[t]={...this.recipes[t],...e}),this.filterRecipes(),this.updateRecipe(e),this.currentRecipe={...this.currentRecipe,...e},this.updateRecipe(e),this.currentRecipe={...e,instructions:Array.isArray(e.instructions)?e.instructions.map((e=>"object"===typeof e?e.step:e)).join("\n"):e.instructions}}this.closeEditModal()}catch(t){this.handleError(t,"Erreur lors de la mise à jour de la recette :"),alert("Une erreur est survenue lors de la mise à jour de la recette.")}},async addToFavorites(){try{if(!this.currentRecipe?.recipe_id)throw new Error("Aucune recette sélectionnée pour ajouter aux favoris.");await te.A.post("https://www.cookaller.com/recipes/favorites/add",{recipeId:this.currentRecipe.recipe_id},{withCredentials:!0}),this.isFavorite=!0,this.currentRecipe.isFavorite=!0;const e=this.recipes.findIndex((e=>e.recipe_id===this.currentRecipe.recipe_id));-1!==e&&(this.recipes[e].isFavorite=!0),this.filterRecipes()}catch(e){e.response&&409===e.response.status?alert("Cette recette est déjà dans vos favoris."):(this.handleError(e,"Erreur lors de l'ajout aux favoris :"),alert("Une erreur est survenue lors de l'ajout aux favoris."))}},async checkIfFavorite(e){try{const t=await te.A.get(`https://www.cookaller.com/recipes/favorites/check/${e}`,{withCredentials:!0});this.isFavorite=t.data.isFavorite}catch(t){this.handleError(t,"Erreur lors de la vérification du statut des favoris :"),this.isFavorite=!1}},async removeFromFavorites(){try{if(!this.currentRecipe?.recipe_id)throw new Error("Aucune recette sélectionnée pour retirer des favoris.");await te.A.delete(`https://www.cookaller.com/recipes/favorites/remove/${this.currentRecipe.recipe_id}`,{withCredentials:!0}),this.isFavorite=!1,this.currentRecipe.isFavorite=!1;const e=this.recipes.findIndex((e=>e.recipe_id===this.currentRecipe.recipe_id));-1!==e&&(this.recipes[e].isFavorite=!1),this.filterRecipes()}catch(e){this.handleError(e,"Erreur lors du retrait des favoris :"),alert("Une erreur est survenue lors du retrait des favoris.")}},confirmDeleteRecipe(){confirm("Êtes-vous sûr de vouloir supprimer cette recette ? Cette action est irréversible.")&&this.deleteRecipe()},async openModal(e){if(e&&e.recipe_id){this.currentRecipe={...e,rating:e.rating||0},this.showModal=!0;try{await this.fetchAverageRating(this.currentRecipe.recipe_id),await this.checkIfFavorite(this.currentRecipe.recipe_id)}catch(t){this.handleError(t,"Erreur lors de l'ouverture du modal.")}}else this.handleError("Aucune recette fournie")},closeModal(){this.showModal=!1,this.currentRecipe=null},openEditModal(e){this.currentRecipe={...e},this.showModal=!1,this.showEditModal=!0},closeEditModal(){this.showEditModal=!1},updateRecipe(e){const t=this.recipes.findIndex((t=>t.recipe_id===e.recipe_id));if(-1!==t){const i=this.recipes[t];e.image_url=e.image_url||i.image_url,this.recipes[t]={...i,...e}}this.closeEditModal()}},mounted(){this.fetchUserRecipes(),this.loadUserAllergens()},watch:{selectedAllergens:{handler(){this.filterRecipes()},deep:!0},showFavorites:"filterRecipes"}},le=i(1241);const ne=(0,le.A)(se,[["render",ee],["__scopeId","data-v-b775ae94"]]);var ce=ne}}]);
//# sourceMappingURL=414.64176ebb.js.map