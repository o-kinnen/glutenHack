"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[747],{9747:function(e,t,n){n.r(t),n.d(t,{default:function(){return D}});var i=n(6768),a=n(5130),r=n(4232);const s={class:"add-ingredients-container"},l={class:"add-ingredients"},o={class:"input-container"},d=["disabled"],u=["disabled"],c=["disabled"],p=["disabled"],g={class:"search-container"},m={class:"upload-container"},h={key:0,class:"image-preview"},y=["src"],k=["disabled"],v={key:0,class:"analysis-results"},f={class:"analysis-grid"},L=["onUpdate:modelValue"],b=["onUpdate:modelValue"],C=["onUpdate:modelValue"],w={key:1,class:"ingredient-list"},I={class:"category-title"},E={class:"ingredient-info"},U={class:"ingredient-quantity"},Q={class:"ingredient-actions"},q=["onUpdate:modelValue"],F=["onClick"],V=["onClick"],A=["onClick"],j={key:2,class:"ingredient-list"},X={class:"ingredient-info"},$={class:"ingredient-quantity"},_={class:"ingredient-actions"},R=["onUpdate:modelValue"],z=["onClick"],S=["onClick"],B=["onClick"],J={key:3,class:"loading-spinner"};function K(e,t,n,K,N,x){return(0,i.uX)(),(0,i.CE)("div",s,[(0,i.Lk)("div",l,[t[14]||(t[14]=(0,i.Lk)("h4",null,"Ajouter des ingrédients :",-1)),(0,i.Lk)("div",o,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>N.newIngredient=e),placeholder:"Entrez un ingrédient",disabled:N.isLoading},null,8,d),[[a.Jo,N.newIngredient]]),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>N.newQuantity=e),type:"number",min:"1",placeholder:"Quantité",disabled:N.isLoading},null,8,u),[[a.Jo,N.newQuantity]]),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>N.newUnit=e),disabled:N.isLoading},t[9]||(t[9]=[(0,i.Fv)('<option value="" data-v-60280dcf>Unités (optionnel)</option><option value="g" data-v-60280dcf>g</option><option value="ml" data-v-60280dcf>ml</option><option value="kg" data-v-60280dcf>kg</option><option value="l" data-v-60280dcf>l</option>',5)]),8,c),[[a.u1,N.newUnit]]),(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>x.addIngredient&&x.addIngredient(...e)),disabled:N.isLoading},"Ajouter",8,p)]),(0,i.Lk)("div",g,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>N.searchIngredient=e),placeholder:"Rechercher un ingrédient"},null,512),[[a.Jo,N.searchIngredient]]),(0,i.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>x.sortIngredientsByCategory&&x.sortIngredientsByCategory(...e)),class:"sort-button"},"Trier par catégorie")]),(0,i.Lk)("div",m,[t[10]||(t[10]=(0,i.Lk)("h5",null,"Uploader une photo :",-1)),(0,i.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>x.onFileChange&&x.onFileChange(...e)),accept:"image/*"},null,32),N.imageUrl?((0,i.uX)(),(0,i.CE)("div",h,[(0,i.Lk)("img",{src:N.imageUrl,alt:"Aperçu de l'image"},null,8,y)])):(0,i.Q3)("",!0),(0,i.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>x.analyzeImage&&x.analyzeImage(...e)),disabled:!N.imageFile||N.isLoading},"Analyser",8,k)]),N.analysisResult.length>0?((0,i.uX)(),(0,i.CE)("div",v,[t[13]||(t[13]=(0,i.Lk)("h5",null,"Résultats de l'analyse :",-1)),(0,i.Lk)("div",f,[t[12]||(t[12]=(0,i.Lk)("div",{class:"grid-header"},[(0,i.Lk)("span",null,"Sélection"),(0,i.Lk)("span",null,"Aliment"),(0,i.Lk)("span",null,"Probabilité"),(0,i.Lk)("span",null,"Quantité"),(0,i.Lk)("span",null,"Unités")],-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(N.analysisResult,((e,n)=>((0,i.uX)(),(0,i.CE)("div",{key:n,class:"grid-row"},[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.selected=t},null,8,L),[[a.lH,e.selected]]),(0,i.Lk)("span",null,(0,r.v_)(e.name),1),(0,i.Lk)("span",null,(0,r.v_)((100*e.probability).toFixed(2))+"%",1),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t=>e.quantity=t,type:"number",min:"1",placeholder:"Quantité",class:"quantity-input"},null,8,b),[[a.Jo,e.quantity]]),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t=>e.unit=t,class:"unit-select"},t[11]||(t[11]=[(0,i.Fv)('<option value="" data-v-60280dcf>Unités (optionnel)</option><option value="g" data-v-60280dcf>g</option><option value="ml" data-v-60280dcf>ml</option><option value="kg" data-v-60280dcf>kg</option><option value="l" data-v-60280dcf>l</option>',5)]),8,C),[[a.u1,e.unit]])])))),128))]),(0,i.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>x.validateSelection&&x.validateSelection(...e)),class:"validate-button"},"Valider")])):(0,i.Q3)("",!0),N.sortByCategory?((0,i.uX)(),(0,i.CE)("div",w,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(x.categorizedIngredients,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"category-group"},[(0,i.Lk)("h5",I,(0,r.v_)(t),1),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e,((e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t,class:"ingredient-item"},[(0,i.Lk)("div",E,[(0,i.Lk)("strong",null,(0,r.v_)(e.name),1),(0,i.Lk)("div",U,(0,r.v_)(e.quantity),1)]),(0,i.Lk)("div",Q,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité"},null,8,q),[[a.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,i.Lk)("button",{onClick:n=>x.updateIngredientQuantity(t,e.name,e.updateQuantity,"add"),class:"add-button"},"Ajouter",8,F),(0,i.Lk)("button",{onClick:n=>x.updateIngredientQuantity(t,e.name,e.updateQuantity,"subtract"),class:"subtract-button"},"Soustraire",8,V),(0,i.Lk)("button",{onClick:n=>x.removeIngredient(t,e.name),class:"remove-button"},"Supprimer",8,A)])])))),128))])])))),128))])):((0,i.uX)(),(0,i.CE)("div",j,[(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(x.filteredIngredients,((e,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t,class:"ingredient-item"},[(0,i.Lk)("div",X,[(0,i.Lk)("strong",null,(0,r.v_)(e.name),1),(0,i.Lk)("div",$,(0,r.v_)(e.quantity),1)]),(0,i.Lk)("div",_,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité"},null,8,R),[[a.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,i.Lk)("button",{onClick:n=>x.updateIngredientQuantity(t,e.name,e.updateQuantity,"add"),class:"add-button"},"Ajouter",8,z),(0,i.Lk)("button",{onClick:n=>x.updateIngredientQuantity(t,e.name,e.updateQuantity,"subtract"),class:"subtract-button"},"Soustraire",8,S),(0,i.Lk)("button",{onClick:n=>x.removeIngredient(t,e.name),class:"remove-button"},"Supprimer",8,B)])])))),128))])])),N.isLoading?((0,i.uX)(),(0,i.CE)("div",J,"Chargement...")):(0,i.Q3)("",!0)])])}n(4114),n(4603),n(7566),n(8721);var N=n(4373),x={name:"IngredientsPage.vue",data(){return{newIngredient:"",newQuantity:"",newUnit:"",searchIngredient:"",ingredients:[],imageFile:null,imageUrl:"",analysisResult:[],isLoading:!1,sortByCategory:!1}},computed:{filteredIngredients(){let e=this.ingredients;return""!==this.searchIngredient.trim()&&(e=e.filter((e=>e.name.toLowerCase().includes(this.searchIngredient.trim().toLowerCase())))),e},categorizedIngredients(){const e={};return this.filteredIngredients.forEach((t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)})),e}},created(){this.fetchIngredientsFromFridge()},methods:{onFileChange(e){const t=e.target.files[0];t&&(this.imageFile=t,this.imageUrl=URL.createObjectURL(t))},async analyzeImage(){if(!this.imageFile)return;const e=new FormData;e.append("image",this.imageFile);try{this.isLoading=!0;const t=await N.A.post("https://tfe-3483aa964321.herokuapp.com/users/test",e,{headers:{"Content-Type":"multipart/form-data"}});t.data&&t.data.data?this.analysisResult=t.data.data.map((e=>({...e,selected:!1,quantity:"",unit:""}))):(this.analysisResult=[],alert("Aucun ingrédient trouvé dans l'image."))}catch(t){console.error("Erreur lors de l'analyse de l'image :",t),alert("Une erreur est survenue lors de l'analyse de l'image.")}finally{this.isLoading=!1}},validateSelection(){const e=this.analysisResult.filter((e=>e.selected&&e.quantity));e.forEach((e=>{this.ingredients.push({name:e.name,quantity:`${e.quantity} ${e.unit}`.trim(),category:"ajoutés",updateQuantity:0})})),this.analysisResult=[]},async fetchIngredientsFromFridge(){try{this.isLoading=!0;const e=await N.A.get("https://tfe-3483aa964321.herokuapp.com/users/fridge",{withCredentials:!0});this.ingredients=e.data.map((e=>({name:e.food_name,quantity:e.quantity,category:e.category||"autres",updateQuantity:0})))}catch(e){console.error("Erreur lors de la récupération des ingrédients :",e)}finally{this.isLoading=!1}},async addIngredient(){const e=/^\d+$/.test(this.newIngredient.trim());let t;if(e){this.isLoading=!0;try{const e=await fetch(`https://world.openfoodfacts.org/api/v0/product/${this.newIngredient}.json`),n=await e.json();if(!(n&&1===n.status&&n.product&&n.product.product_name))return void alert("Produit non trouvé pour ce code-barres.");t=n.product.product_name}catch(n){return console.error("Erreur lors de la recherche du produit :",n),void alert("Une erreur est survenue lors de la recherche du produit.")}finally{this.isLoading=!1}}else{if(!this.newIngredient.trim())return;t=this.newIngredient.trim()}if(t){const e=this.ingredients.findIndex((e=>e.name===t&&e.quantity.includes(this.newUnit)));if(-1!==e){const i=this.ingredients[e],a=i.quantity,r=a.match(/^([\d.]+)\s*(.*)$/);if(!r)return void alert("Impossible de traiter la quantité actuelle.");const s=parseFloat(r[1]),l=r[2],o=parseFloat(this.newQuantity)||1,d=s+o;try{const n=await N.A.put("https://tfe-3483aa964321.herokuapp.com/users/fridge/update",{foodName:t,quantity:d,unit:l},{withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${d} ${l}`.trim()}catch(n){return void console.error("Erreur lors de la mise à jour de l'aliment :",n)}}else try{const e=await N.A.post("https://tfe-3483aa964321.herokuapp.com/users/fridge/add",{foodName:t,quantity:`${this.newQuantity||1} ${this.newUnit}`.trim()},{withCredentials:!0});if(200!==e.status)throw new Error("Erreur lors de l'ajout de l'aliment dans le réfrigérateur de l'utilisateur.");await this.fetchIngredientsFromFridge()}catch(n){n.response&&404===n.response.status?alert("L'aliment n'est pas encore dans la base de données."):console.error("Erreur lors de l'ajout de l'aliment :",n)}}this.newIngredient="",this.newQuantity="",this.newUnit="",this.$emit("ingredients-updated",this.ingredients)},async updateIngredientQuantity(e,t,n,i){if(!n||n<=0)return void alert("Veuillez entrer une quantité valide.");const a=this.ingredients[e].quantity,r=a.match(/^([\d.]+)\s*(.*)$/);if(!r)return void alert("Impossible de traiter la quantité actuelle.");const s=parseFloat(r[1]),l=r[2];let o;if("add"===i)o=s+n;else if("subtract"===i&&(o=s-n,o<=0))return void alert("La quantité ne peut pas être inférieure ou égale à zéro.");try{const n=await N.A.put("https://tfe-3483aa964321.herokuapp.com/users/fridge/update",{foodName:t,quantity:o,unit:l},{withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${o} ${l}`.trim()}catch(d){console.error("Erreur lors de la mise à jour de l'aliment :",d)}},async removeIngredient(e,t){try{const n=await N.A.delete("https://tfe-3483aa964321.herokuapp.com/users/fridge/delete",{params:{foodName:t},withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la suppression de l'aliment du réfrigérateur de l'utilisateur.");this.ingredients.splice(e,1),this.$emit("ingredients-updated",this.ingredients)}catch(n){console.error("Erreur lors de la suppression de l'aliment :",n)}},sortIngredientsByCategory(){this.sortByCategory=!this.sortByCategory}}},P=n(1241);const T=(0,P.A)(x,[["render",K],["__scopeId","data-v-60280dcf"]]);var D=T}}]);
//# sourceMappingURL=747.68c3b8de.js.map