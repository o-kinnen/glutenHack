"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[795],{9795:function(e,t,r){r.r(t),r.d(t,{default:function(){return z}});var s=r(6768),i=r(5130),n=r(4232);const a={class:"recipe-page"},l={class:"allergen-filters"},c={key:0,style:{"text-align":"center"}},o={key:1,class:"no-recipes"},u={key:2,class:"recipes-list"},p={key:0,class:"favorite-icon"},d=["src"],h=["onClick"],g={key:2,class:"attention-warning"},v={key:3,class:"modal-overlay"},f={class:"modal-content"},k=["src"],m={class:"recipe-info-container"},R={class:"recipe-info-line"},y={class:"info-item"},_={class:"info-item"},L={class:"info-item"},A={class:"info-item"},F={class:"recipe-info-line"},w={class:"info-item"},C={class:"info-item"},E={class:"info-item"},b={key:1,style:{"text-align":"center"}},x={key:2,style:{"text-align":"center"}},I={class:"average-rating"},X={class:"rating-container"},M={class:"stars"},S=["onClick"];function T(e,t,r,T,U,P){return(0,s.uX)(),(0,s.CE)("div",a,[t[33]||(t[33]=(0,s.Lk)("h2",null,"Toutes les recettes",-1)),(0,s.Lk)("div",l,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:"Gluten","onUpdate:modelValue":t[0]||(t[0]=e=>U.selectedAllergens=e)},null,512),[[i.lH,U.selectedAllergens]]),t[13]||(t[13]=(0,s.eW)(" Sans Gluten "))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:"Lactose","onUpdate:modelValue":t[1]||(t[1]=e=>U.selectedAllergens=e)},null,512),[[i.lH,U.selectedAllergens]]),t[14]||(t[14]=(0,s.eW)(" Sans Lactose "))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:"Oeuf","onUpdate:modelValue":t[2]||(t[2]=e=>U.selectedAllergens=e)},null,512),[[i.lH,U.selectedAllergens]]),t[15]||(t[15]=(0,s.eW)(" Sans Oeuf "))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:"Arachide","onUpdate:modelValue":t[3]||(t[3]=e=>U.selectedAllergens=e)},null,512),[[i.lH,U.selectedAllergens]]),t[16]||(t[16]=(0,s.eW)(" Sans Arachide "))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>U.showProfileFilter=e),onChange:t[5]||(t[5]=(...e)=>P.filterRecipes&&P.filterRecipes(...e))},null,544),[[i.lH,U.showProfileFilter]]),t[17]||(t[17]=(0,s.eW)(" Mon profil "))])]),U.showProfileFilter&&0===U.userAllergens.length?((0,s.uX)(),(0,s.CE)("p",c," Seules les recettes sans mention d'allergènes sont affichées car vous n'avez spécifié aucun allergène dans votre profil. ")):(0,s.Q3)("",!0),(0,s.Lk)("div",null,[(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>P.toggleFavorites&&P.toggleFavorites(...e))},(0,n.v_)(U.showFavorites?"Afficher toutes les recettes":"Afficher mes favoris"),1)]),0===U.recipes.length?((0,s.uX)(),(0,s.CE)("div",o,t[18]||(t[18]=[(0,s.Lk)("p",null,"Aucune recette n'a été enregistrée pour le moment.",-1)]))):((0,s.uX)(),(0,s.CE)("div",u,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(U.filteredRecipes,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.recipe_id,class:"recipe-card"},[(0,s.Lk)("h3",null,(0,n.v_)(e.recipe_name),1),e.isFavorite?((0,s.uX)(),(0,s.CE)("div",p,t[19]||(t[19]=[(0,s.Lk)("i",{class:"bi bi-heart-fill",style:{color:"red"}},null,-1)]))):(0,s.Q3)("",!0),e.image_url?((0,s.uX)(),(0,s.CE)("img",{key:1,src:e.image_url,alt:"Image de la recette",class:"modal-recipe-image"},null,8,d)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:t=>P.openModal(e)},"Voir les détails",8,h),P.getMissingAllergens(e).length>0?((0,s.uX)(),(0,s.CE)("div",g,[t[22]||(t[22]=(0,s.Lk)("i",{class:"bi bi-exclamation-triangle-fill"},null,-1)),(0,s.Lk)("p",null,[t[20]||(t[20]=(0,s.eW)(" Ces allergènes ne sont pas pris en compte dans cette recette : ")),(0,s.Lk)("strong",null,(0,n.v_)(P.getMissingAllergens(e).join(", ")),1),t[21]||(t[21]=(0,s.eW)(". "))])])):(0,s.Q3)("",!0)])))),128))])),U.showModal?((0,s.uX)(),(0,s.CE)("div",v,[(0,s.Lk)("div",f,[(0,s.Lk)("button",{class:"close-btn",onClick:t[7]||(t[7]=(...e)=>P.closeModal&&P.closeModal(...e))},"X"),(0,s.Lk)("h3",null,(0,n.v_)(U.currentRecipe.recipe_name),1),U.currentRecipe.image_url?((0,s.uX)(),(0,s.CE)("img",{key:0,src:U.currentRecipe.image_url,alt:"Image de la recette",class:"recipe-image"},null,8,k)):(0,s.Q3)("",!0),(0,s.Lk)("div",m,[(0,s.Lk)("div",R,[(0,s.Lk)("div",y,[t[23]||(t[23]=(0,s.Lk)("strong",null,"Généré par l'IA :",-1)),(0,s.eW)(" "+(0,n.v_)(U.currentRecipe.created_by_ai?"Oui":"Non"),1)]),(0,s.Lk)("div",_,[t[24]||(t[24]=(0,s.Lk)("strong",null,"Temps de préparation:",-1)),(0,s.eW)(" "+(0,n.v_)(U.currentRecipe.preparation_time),1)]),(0,s.Lk)("div",L,[t[25]||(t[25]=(0,s.Lk)("strong",null,"Difficulté:",-1)),(0,s.eW)(" "+(0,n.v_)(U.currentRecipe.difficulty),1)]),(0,s.Lk)("div",A,[t[26]||(t[26]=(0,s.Lk)("strong",null,"Nombre de personnes:",-1)),(0,s.eW)(" "+(0,n.v_)(U.currentRecipe.number_of_person),1)])]),(0,s.Lk)("div",F,[(0,s.Lk)("div",w,[t[27]||(t[27]=(0,s.Lk)("strong",null,"Cuisine:",-1)),(0,s.eW)(" "+(0,n.v_)(U.currentRecipe.cuisine_type),1)]),(0,s.Lk)("div",C,[t[28]||(t[28]=(0,s.Lk)("strong",null,"Type:",-1)),(0,s.eW)(" "+(0,n.v_)(U.currentRecipe.category_type),1)]),(0,s.Lk)("div",E,[t[29]||(t[29]=(0,s.Lk)("strong",null,"Sans allergène :",-1)),(0,s.eW)(" "+(0,n.v_)(U.currentRecipe.allergens_list?.join(", ")||"Pas de mention"),1)])])]),t[31]||(t[31]=(0,s.Lk)("h4",null,"Ingrédients",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(U.currentRecipe.ingredients,((e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:t},(0,n.v_)(e.quantity)+" "+(0,n.v_)(e.food_name),1)))),128))]),t[32]||(t[32]=(0,s.Lk)("h4",null,"Instructions",-1)),(0,s.Lk)("ol",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(P.formattedInstructionsArray,((e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:t},(0,n.v_)(e),1)))),128))]),0===U.currentRecipe.averageRating?((0,s.uX)(),(0,s.CE)("p",b,"Cette recette n'a pas encore été notée.")):((0,s.uX)(),(0,s.CE)("p",x,"Voici la note reçue de la recette.")),(0,s.Lk)("div",I,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(5,(e=>(0,s.Lk)("span",{key:e,class:(0,n.C4)(["star",{filled:e<=U.currentRecipe.averageRating}])}," ★ ",2))),64))]),(0,s.Lk)("div",X,[t[30]||(t[30]=(0,s.Lk)("p",{style:{"text-align":"center"}},"Noter la recette ?",-1)),(0,s.Lk)("div",M,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(5,(e=>(0,s.Lk)("span",{key:e,class:(0,n.C4)(["star",{filled:e<=U.currentRecipe.rating}]),onClick:t=>P.rateRecipe(e)}," ★ ",10,S))),64))])]),(0,s.Lk)("div",null,[U.isFavorite?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t[9]||(t[9]=(...e)=>P.removeFromFavorites&&P.removeFromFavorites(...e))},"Retirer des favoris")):((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[8]||(t[8]=(...e)=>P.addToFavorites&&P.addToFavorites(...e))},"Ajouter aux favoris"))]),(0,s.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>P.addToShoppingList&&P.addToShoppingList(...e))},"Ajouter à la liste des courses"),(0,s.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>P.generatePDF&&P.generatePDF(...e))},"Exporter en PDF"),(0,s.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>P.closeModal&&P.closeModal(...e))},"Fermer")])])):(0,s.Q3)("",!0)])}var U=r(4373),P=r(1749),W={name:"AllRecipesPage",data(){return{recipes:[],userAllergens:[],filteredRecipes:[],selectedAllergens:[],showProfileFilter:!1,showModal:!1,currentRecipe:null,errorMessage:"",isFavorite:!1,showFavorites:!1}},computed:{formattedInstructionsArray(){return this.currentRecipe?.instructions?this.currentRecipe.instructions.split("\n").filter((e=>""!==e.trim())):[]}},methods:{toggleFavorites(){this.showFavorites=!this.showFavorites,this.filterRecipes()},filterRecipes(){this.filteredRecipes=this.recipes.filter((e=>{const t=!this.showFavorites||e.isFavorite,r=this.selectedAllergens.every((t=>e.allergens_list?.includes(t))),s=!this.showProfileFilter||(0===this.userAllergens.length?!e.allergens_list||0===e.allergens_list.length:this.userAllergens.every((t=>e.allergens_list?.includes(t))));return t&&r&&s}))},async convertImageToBase64(e){return new Promise(((t,r)=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{const e=document.createElement("canvas");e.width=s.width,e.height=s.height;const r=e.getContext("2d");r.drawImage(s,0,0),t(e.toDataURL("image/png"))},s.onerror=e=>r(e),s.src=e}))},async generatePDF(){if(!this.currentRecipe)return void alert("Aucune recette sélectionnée pour générer le PDF.");const e=new P.uE;let t=10;e.setFontSize(20),e.text(this.currentRecipe.recipe_name,10,t),t+=10,e.setFontSize(12),e.text(`Temps de préparation: ${this.currentRecipe.preparation_time}`,10,t),t+=10,e.text(`Difficulté: ${this.currentRecipe.difficulty}`,10,t),t+=10,e.text(`Nombre de personnes: ${this.currentRecipe.number_of_person}`,10,t),t+=10,e.text(`Cuisine: ${this.currentRecipe.cuisine_type}`,10,t),t+=10,e.text(`Type: ${this.currentRecipe.category_type}`,10,t),t+=10;const r=this.currentRecipe.allergens_list?.length?this.currentRecipe.allergens_list.join(", "):"Aucun allergène spécifié.";if(e.text(`Sans allergène: ${r}`,10,t),t+=10,this.currentRecipe.image_url)try{const r=await this.convertImageToBase64(this.currentRecipe.image_url);e.addImage(r,"PNG",10,t,80,80),t+=90}catch(i){console.error("Erreur lors du chargement de l'image :",i)}e.setFontSize(14),e.text("Ingrédients:",10,t),t+=10,e.setFontSize(12),this.currentRecipe.ingredients.forEach((r=>{e.text(`${r.quantity} ${r.food_name}`,10,t),t+=10})),e.setFontSize(14),e.text("Instructions:",10,t),t+=10,e.setFontSize(12);const s=10;this.formattedInstructionsArray.forEach(((r,i)=>{const n=e.splitTextToSize(`${i+1}. ${r}`,190);e.text(n,10,t),t+=n.length*s})),e.save(`${this.currentRecipe.recipe_name}.pdf`)},async rateRecipe(e){try{if(!this.currentRecipe?.recipe_id)throw new Error("Aucune recette sélectionnée.");const t=await U.A.post("https://tfe-3483aa964321.herokuapp.com/recipes/rate",{recipeId:this.currentRecipe.recipe_id,rating:e},{withCredentials:!0});alert(t.data.message||"Note enregistrée avec succès."),this.currentRecipe.rating=e,await this.fetchAverageRating(this.currentRecipe.recipe_id)}catch(t){console.error("Erreur lors de l'envoi de la note :",t),alert("Une erreur est survenue lors de l'enregistrement de la note.")}},async fetchAverageRating(e){try{const t=await U.A.get(`https://tfe-3483aa964321.herokuapp.com/recipes/rate/average/${e}`,{withCredentials:!0});this.currentRecipe.averageRating=parseFloat(t.data.averageRating)||0}catch(t){console.error("Erreur lors de la récupération de la moyenne des notes :",t),this.currentRecipe.averageRating=0,alert("Impossible de récupérer la moyenne des notes.")}},async fetchRecipes(){try{const e=await U.A.get("https://tfe-3483aa964321.herokuapp.com/recipes/all",{withCredentials:!0}),t=await U.A.get("https://tfe-3483aa964321.herokuapp.com/recipes/favorites",{withCredentials:!0}),r=t.data.map((e=>e.recipe_id));this.recipes=e.data.map((e=>({...e,isFavorite:r.includes(e.recipe_id)}))),this.filterRecipes()}catch(e){console.error("Erreur lors de la récupération des recettes :",e),this.errorMessage="Une erreur est survenue lors de la récupération des recettes. Veuillez réessayer plus tard."}},async addToFavorites(){try{if(!this.currentRecipe?.recipe_id)throw new Error("Aucune recette sélectionnée pour ajouter aux favoris.");const e=await U.A.post("https://tfe-3483aa964321.herokuapp.com/recipes/favorites/add",{recipeId:this.currentRecipe.recipe_id},{withCredentials:!0});alert(e.data.message||"Recette ajoutée aux favoris avec succès."),this.isFavorite=!0,this.currentRecipe.isFavorite=!0;const t=this.recipes.findIndex((e=>e.recipe_id===this.currentRecipe.recipe_id));-1!==t&&(this.recipes[t].isFavorite=!0),this.filterRecipes()}catch(e){e.response&&409===e.response.status?alert("Cette recette est déjà dans vos favoris."):(console.error("Erreur lors de l'ajout aux favoris :",e),alert("Une erreur est survenue lors de l'ajout aux favoris."))}},async checkIfFavorite(e){try{const t=await U.A.get(`https://tfe-3483aa964321.herokuapp.com/recipes/favorites/check/${e}`,{withCredentials:!0});this.isFavorite=t.data.isFavorite}catch(t){console.error("Erreur lors de la vérification du statut des favoris :",t),this.isFavorite=!1}},async removeFromFavorites(){try{if(!this.currentRecipe?.recipe_id)throw new Error("Aucune recette sélectionnée pour retirer des favoris.");const e=await U.A.delete(`https://tfe-3483aa964321.herokuapp.com/recipes/favorites/remove/${this.currentRecipe.recipe_id}`,{withCredentials:!0});alert(e.data.message||"Recette retirée des favoris avec succès."),this.isFavorite=!1,this.currentRecipe.isFavorite=!1;const t=this.recipes.findIndex((e=>e.recipe_id===this.currentRecipe.recipe_id));-1!==t&&(this.recipes[t].isFavorite=!1),this.filterRecipes()}catch(e){console.error("Erreur lors du retrait des favoris :",e),alert("Une erreur est survenue lors du retrait des favoris.")}},async loadUserAllergens(){this.userAllergens=await this.fetchUserAllergens()},async fetchUserAllergens(){try{const e=await U.A.get("https://tfe-3483aa964321.herokuapp.com/users/restrictions",{withCredentials:!0});return e.data.restrictions||[]}catch(e){return console.error("Erreur lors de la récupération des restrictions alimentaires :",e),alert("Impossible de récupérer les restrictions alimentaires. Veuillez réessayer."),[]}},getMissingAllergens(e){return this.userAllergens.length?e.allergens_list?this.userAllergens.filter((t=>!e.allergens_list.includes(t))):[...this.userAllergens]:[]},async addToShoppingList(){try{const e=await U.A.post("https://tfe-3483aa964321.herokuapp.com/shopping-list/add",{recipeId:this.currentRecipe.recipe_id},{withCredentials:!0});alert(e.data.message)}catch(e){console.error("Erreur lors de l'ajout à la liste des courses:",e),alert("Une erreur est survenue.")}},async openModal(e){this.currentRecipe={...e,rating:e.rating||0},this.showModal=!0,this.currentRecipe?.recipe_id&&(await this.fetchAverageRating(this.currentRecipe.recipe_id),await this.checkIfFavorite(this.currentRecipe.recipe_id))},closeModal(){this.showModal=!1,this.currentRecipe=null}},mounted(){this.fetchRecipes(),this.loadUserAllergens()},watch:{selectedAllergens:{handler(){this.filterRecipes()},deep:!0},showFavorites:"filterRecipes"}},$=r(1241);const j=(0,$.A)(W,[["render",T],["__scopeId","data-v-3f46e2a1"]]);var z=j}}]);
//# sourceMappingURL=795.c7043a64.js.map