"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[852],{5852:function(e,s,t){t.r(s),t.d(s,{default:function(){return w}});var r=t(6768),l=t(4232),o=t(5130);const n={class:"container"},i={class:"card p-4 text-white"},a={key:0,class:"allergens-grid"},c=["src"],u={key:1},d={key:2,class:"error-alert"},m={class:"mt-4"},h={key:0,class:"modal-overlay"},p={class:"modal-content"},k={class:"checkbox-group"},f=["onUpdate:modelValue"],g={class:"text-and-icon"},b=["src"];function v(e,s,t,v,y,E){return(0,r.uX)(),(0,r.CE)("div",n,[(0,r.Lk)("div",i,[(0,r.Lk)("h2",null,"Bienvenue "+(0,l.v_)(y.username)+" !",1),(0,r.Lk)("p",null,[s[5]||(s[5]=(0,r.eW)("Mon adresse mail : ")),(0,r.Lk)("strong",null,(0,l.v_)(y.email),1)]),s[9]||(s[9]=(0,r.Lk)("p",null,"Mes allergènes :",-1)),E.selectedRestrictions.length?((0,r.uX)(),(0,r.CE)("div",a,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(E.selectedRestrictions,((e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:s,class:"allergen-item"},[(0,r.Lk)("img",{src:`/img/${e.toLowerCase()}.png`,alt:"Icone",class:"restriction-icon"},null,8,c),(0,r.Lk)("span",null,[(0,r.Lk)("strong",null,(0,l.v_)(e),1)])])))),128))])):((0,r.uX)(),(0,r.CE)("p",u,s[6]||(s[6]=[(0,r.Lk)("strong",null,"Aucun",-1)]))),y.errorMessage?((0,r.uX)(),(0,r.CE)("div",d,(0,l.v_)(y.errorMessage),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",m,[(0,r.Lk)("button",{class:"button btn mb-2",onClick:s[0]||(s[0]=(...e)=>E.modifyProfile&&E.modifyProfile(...e))},"Modifier mes allergènes"),s[7]||(s[7]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("button",{class:"button btn mb-2",onClick:s[1]||(s[1]=(...e)=>E.logout&&E.logout(...e))},"Se déconnecter"),s[8]||(s[8]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("button",{class:"button btn",onClick:s[2]||(s[2]=(...e)=>E.deleteAccount&&E.deleteAccount(...e))},"Supprimer le compte")])]),y.showModal?((0,r.uX)(),(0,r.CE)("div",h,[(0,r.Lk)("div",p,[s[11]||(s[11]=(0,r.Lk)("h2",null,"Mes allergènes",-1)),(0,r.Lk)("form",{onSubmit:s[4]||(s[4]=(0,o.D$)(((...e)=>E.submitForm&&E.submitForm(...e)),["prevent"]))},[(0,r.Lk)("div",k,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(y.restrictions,(e=>((0,r.uX)(),(0,r.CE)("label",{key:e.name},[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":s=>e.selected=s},null,8,f),[[o.lH,e.selected]]),(0,r.Lk)("span",g,[(0,r.Lk)("img",{src:`/img/${e.name.toLowerCase()}.png`,alt:"Icone",class:"restriction-icon"},null,8,b),(0,r.eW)(" "+(0,l.v_)(e.name),1)])])))),128))]),s[10]||(s[10]=(0,r.Lk)("button",{type:"submit",class:"button btn me-3"},"Confirmer",-1)),(0,r.Lk)("button",{type:"button",class:"button btn",onClick:s[3]||(s[3]=e=>y.showModal=!1)},"Fermer")],32)])])):(0,r.Q3)("",!0)])}t(4114);var y={name:"ProfilePage",data(){return{username:"",email:"",userId:null,showModal:!1,errorMessage:"",restrictions:[{name:"Gluten",selected:!1},{name:"Lait",selected:!1},{name:"Oeufs",selected:!1},{name:"Arachide",selected:!1},{name:"Noix",selected:!1},{name:"Poissons",selected:!1},{name:"Soja",selected:!1},{name:"Crustacés",selected:!1},{name:"Moutarde",selected:!1},{name:"Céleri",selected:!1}]}},computed:{selectedRestrictions(){return this.restrictions.filter((e=>e.selected)).map((e=>e.name))},selectedRestrictionsText(){return this.selectedRestrictions.length?this.selectedRestrictions.join(", "):"Aucun"}},methods:{async fetchProfile(){try{const e=await fetch("https://www.cookaller.com/users/profile",{credentials:"include"}),s=await e.json();e.ok?(this.username=s.username,this.email=s.email,this.userId=s.user_id,this.updatePreferencesFromProfile(s.restrictions)):(this.errorMessage=s.message||"Erreur lors de la récupération des informations du profil.",this.$router.push("/login"))}catch(e){this.handleError("Erreur lors de la communication avec le serveur. Veuillez réessayer plus tard.",e)}},updatePreferencesFromProfile(e){this.restrictions.forEach((s=>{s.selected=e.includes(s.name)}))},modifyProfile(){this.showModal=!0},async submitForm(){const e=this.restrictions.filter((e=>e.selected)).map((e=>e.name));try{const s=await fetch(`https://www.cookaller.com/users/update-preferences/${this.userId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({restrictions:e}),credentials:"include"});s.ok?(this.showModal=!1,await this.fetchProfile()):this.handleError("Erreur lors de la mise à jour des préférences.")}catch(s){this.handleError("Erreur:",s)}},async logout(){try{const e=await fetch("https://www.cookaller.com/users/logout",{method:"POST",credentials:"include"});e.ok?(this.$store.dispatch("logout"),this.$router.push("/login")):this.handleError("Erreur lors de la déconnexion. Veuillez réessayer.")}catch(e){this.handleError("Erreur lors de la communication avec le serveur. Veuillez réessayer plus tard.",e)}},async deleteAccount(){if(confirm("Êtes-vous sûr de vouloir supprimer votre compte ? Les recettes publiques seront conservées en anonyme et seules les recettes privées seront supprimées."))try{const e=await fetch("https://www.cookaller.com/users/delete",{method:"DELETE",credentials:"include"});e.ok?(alert("Votre compte a été supprimé avec succès."),this.$store.dispatch("logout"),this.$router.push("/")):this.handleError("Erreur lors de la suppression du compte. Veuillez réessayer.")}catch(e){this.handleError("Erreur lors de la communication avec le serveur. Veuillez réessayer plus tard.",e)}},handleError(e,s=null){this.errorMessage=e}},created(){this.fetchProfile()}},E=t(1241);const L=(0,E.A)(y,[["render",v],["__scopeId","data-v-edf35418"]]);var w=L}}]);
//# sourceMappingURL=852.4d70d41c.js.map