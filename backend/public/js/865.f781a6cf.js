"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[865],{7865:function(e,t,i){i.r(t),i.d(t,{default:function(){return ee}});var n=i(6768),a=i(5130),s=i(4232);const l={class:"container"},r={class:"card p-4 text-white"},o={class:"input-text"},d=["disabled"],u={class:"input-container"},c=["disabled"],p=["disabled"],g={class:"modal-actions-icons"},m={class:"upload-container"},h={key:0,class:"image-preview"},y=["src"],k=["disabled"],v={key:0,class:"loading-spinner"},w={class:"search-container"},L={key:1,class:"empty-message"},f={key:2,class:"modal-overlay"},b={class:"modal-content"},C={key:0,class:"analysis-results"},I={class:"analysis-grid"},q=["onUpdate:modelValue"],E=["onUpdate:modelValue"],Q={key:0,class:"error-message"},U=["onUpdate:modelValue"],F={key:3,class:"ingredient-list"},A={class:"category-title"},$={class:"ingredient-info"},V={class:"ingredient-quantity"},X={class:"ingredient-actions"},j=["onUpdate:modelValue"],x={class:"modal-actions-icons"},M=["onClick"],z=["onClick"],R=["onClick"],_={key:4,class:"ingredient-list"},S={class:"ingredient-info"},B={class:"ingredient-quantity"},D={class:"ingredient-actions"},J=["onUpdate:modelValue"],N={class:"modal-actions-icons"},K=["onClick"],O=["onClick"],P=["onClick"];function H(e,t,i,H,T,G){return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",r,[t[20]||(t[20]=(0,n.Lk)("h1",null,"Ingrédients en stock ",-1)),t[21]||(t[21]=(0,n.Lk)("p",null,"Entrez un ingrédient pour l'ajouter à votre stock.",-1)),(0,n.Lk)("div",o,[(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>T.newIngredient=e),placeholder:"Ingrédient",disabled:T.isLoading},null,8,d),[[a.Jo,T.newIngredient]])]),(0,n.Lk)("div",u,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.newQuantity=e),type:"number",min:"1",placeholder:"Quantité",disabled:T.isLoading,class:"quantity-input"},null,8,c),[[a.Jo,T.newQuantity]]),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>T.newUnit=e),disabled:T.isLoading},t[9]||(t[9]=[(0,n.Fv)('<option value="" data-v-8075dd26>Unités</option><option value="g" data-v-8075dd26>g</option><option value="kg" data-v-8075dd26>kg</option><option value="ml" data-v-8075dd26>ml</option><option value="l" data-v-8075dd26>l</option>',5)]),8,p),[[a.u1,T.newUnit]]),(0,n.Lk)("div",g,[(0,n.Lk)("i",{class:"bi bi-plus-circle-fill icon-action",onClick:t[3]||(t[3]=(...e)=>G.addIngredient&&G.addIngredient(...e)),title:"Ajouter"})])]),(0,n.Lk)("div",m,[t[10]||(t[10]=(0,n.Lk)("h5",null,"Uploader une photo :",-1)),(0,n.Lk)("input",{type:"file",onChange:t[4]||(t[4]=(...e)=>G.onFileChange&&G.onFileChange(...e)),accept:"image/*"},null,32),T.imageUrl?((0,n.uX)(),(0,n.CE)("div",h,[(0,n.Lk)("img",{src:T.imageUrl,alt:"Aperçu de l'image"},null,8,y)])):(0,n.Q3)("",!0)]),(0,n.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>G.analyzeImage&&G.analyzeImage(...e)),disabled:!T.imageFile||T.isLoading,class:"analyze-button"},"Analyser",8,k),T.isLoading?((0,n.uX)(),(0,n.CE)("div",v,"Chargement...")):(0,n.Q3)("",!0),(0,n.Lk)("div",w,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>T.searchIngredient=e),placeholder:"Rechercher"},null,512),[[a.Jo,T.searchIngredient]])]),t[22]||(t[22]=(0,n.Lk)("br",null,null,-1)),0===T.ingredients.length?((0,n.uX)(),(0,n.CE)("div",L," La liste des ingrédients est vide... ")):(0,n.Q3)("",!0),T.showModal?((0,n.uX)(),(0,n.CE)("div",f,[(0,n.Lk)("div",b,[(0,n.Lk)("button",{class:"close-btn",onClick:t[7]||(t[7]=(...e)=>G.closeModal&&G.closeModal(...e))},"X"),T.analysisResult.length>0?((0,n.uX)(),(0,n.CE)("div",C,[t[13]||(t[13]=(0,n.Lk)("h5",null,"Résultats de l'analyse :",-1)),(0,n.Lk)("div",I,[t[12]||(t[12]=(0,n.Lk)("div",{class:"grid-header"},[(0,n.Lk)("span",null,"Sélection"),(0,n.Lk)("span",null,"Aliment"),(0,n.Lk)("span",null,"Probabilité"),(0,n.Lk)("span",null,"Quantité"),(0,n.Lk)("span",null,"Unités")],-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(T.analysisResult,((e,i)=>((0,n.uX)(),(0,n.CE)("div",{key:i,class:"grid-row"},[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.selected=t},null,8,q),[[a.lH,e.selected]]),(0,n.Lk)("span",null,(0,s.v_)(e.name),1),(0,n.Lk)("span",null,(0,s.v_)((100*e.probability).toFixed(2))+"%",1),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t=>e.quantity=t,type:"number",min:"1",placeholder:"Quantité",class:(0,s.C4)(["quantity-input",{error:e.selected&&(!e.quantity||parseFloat(e.quantity)<=0)}])},null,10,E),[[a.Jo,e.quantity]]),T.errorMessage?((0,n.uX)(),(0,n.CE)("div",Q,(0,s.v_)(T.errorMessage),1)):(0,n.Q3)("",!0),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":t=>e.unit=t,class:"unit-select"},t[11]||(t[11]=[(0,n.Fv)('<option value="" data-v-8075dd26>Unités</option><option value="g" data-v-8075dd26>g</option><option value="ml" data-v-8075dd26>ml</option><option value="kg" data-v-8075dd26>kg</option><option value="l" data-v-8075dd26>l</option>',5)]),8,U),[[a.u1,e.unit]])])))),128))]),(0,n.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>G.validateSelection&&G.validateSelection(...e)),class:"button align-center"},"Ajouter")])):(0,n.Q3)("",!0)])])):(0,n.Q3)("",!0),T.sortByCategory?((0,n.uX)(),(0,n.CE)("div",F,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(G.categorizedIngredients,((e,i)=>((0,n.uX)(),(0,n.CE)("div",{key:i,class:"category-group"},[(0,n.Lk)("h5",A,(0,s.v_)(i),1),(0,n.Lk)("ul",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e,((e,i)=>((0,n.uX)(),(0,n.CE)("li",{key:i,class:"ingredient-item"},[(0,n.Lk)("div",$,[(0,n.Lk)("strong",null,(0,s.v_)(e.name),1),(0,n.Lk)("div",V,(0,s.v_)(e.quantity),1)]),(0,n.Lk)("div",X,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité",class:"quantity-input"},null,8,j),[[a.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,n.Lk)("div",x,[(0,n.Lk)("i",{class:"bi bi-plus-circle-fill icon-action",onClick:t=>G.updateIngredientQuantity(i,e.name,e.updateQuantity,"add"),title:"Ajouter"},null,8,M),t[14]||(t[14]=(0,n.Lk)("span",{class:"tooltip-text"},"Ajouter",-1)),(0,n.Lk)("i",{class:"bi bi-dash-circle-fill icon-action",onClick:t=>G.updateIngredientQuantity(i,e.name,e.updateQuantity,"subtract"),title:"Diminuer"},null,8,z),t[15]||(t[15]=(0,n.Lk)("span",{class:"tooltip-text"},"Diminuer",-1)),(0,n.Lk)("i",{class:"bi bi-trash-fill icon-action",onClick:t=>G.removeIngredient(i,e.name),title:"Supprimer"},null,8,R),t[16]||(t[16]=(0,n.Lk)("span",{class:"tooltip-text"},"Supprimer",-1))])])])))),128))])])))),128))])):((0,n.uX)(),(0,n.CE)("div",_,[(0,n.Lk)("ul",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(G.filteredIngredients,((e,i)=>((0,n.uX)(),(0,n.CE)("li",{key:i,class:"ingredient-item"},[(0,n.Lk)("div",S,[(0,n.Lk)("strong",null,(0,s.v_)(e.name),1),(0,n.Lk)("div",B,[(0,n.Lk)("strong",null,"("+(0,s.v_)(e.quantity)+")",1)])]),(0,n.Lk)("div",D,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité",class:"quantity-input"},null,8,J),[[a.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,n.Lk)("div",N,[(0,n.Lk)("i",{class:"bi bi-plus-circle-fill icon-action",onClick:t=>G.updateIngredientQuantity(i,e.name,e.updateQuantity,"add"),title:"Ajouter"},null,8,K),t[17]||(t[17]=(0,n.Lk)("span",{class:"tooltip-text"},"Ajouter",-1)),(0,n.Lk)("i",{class:"bi bi-dash-circle-fill icon-action",onClick:t=>G.updateIngredientQuantity(i,e.name,e.updateQuantity,"subtract"),title:"Diminuer"},null,8,O),t[18]||(t[18]=(0,n.Lk)("span",{class:"tooltip-text"},"Diminuer",-1)),(0,n.Lk)("i",{class:"bi bi-trash-fill icon-action",onClick:t=>G.removeIngredient(i,e.name),title:"Supprimer"},null,8,P),t[19]||(t[19]=(0,n.Lk)("span",{class:"tooltip-text"},"Supprimer",-1))])])])))),128))])]))])])}i(4114),i(4603),i(7566),i(8721);var T=i(4373),G=i(2295),W={name:"IngredientsPage.vue",data(){return{newIngredient:"",newQuantity:"",newUnit:"",searchIngredient:"",ingredients:[],imageFile:null,imageUrl:"",analysisResult:[],isLoading:!1,sortByCategory:!1,errorMessage:"",showModal:!1,scanner:null,scannerActive:!1}},computed:{filteredIngredients(){let e=this.ingredients;return""!==this.searchIngredient.trim()&&(e=e.filter((e=>e.name.toLowerCase().includes(this.searchIngredient.trim().toLowerCase())))),e},categorizedIngredients(){const e={};return this.filteredIngredients.forEach((t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)})),e}},created(){this.fetchIngredientsFromFridge()},methods:{onFileChange(e){const t=e.target.files[0];t&&(this.imageFile=t,this.imageUrl=URL.createObjectURL(t))},async activerScanner(){try{this.scanner=new G.sx;const e={video:{facingMode:{exact:"environment"}}},t=document.getElementById("scanner"),i=await this.scanner.decodeOnceFromVideoDevice(null,t,e);i&&(this.newIngredient=i.text,console.log(this.newIngredient),this.addIngredient())}catch(e){console.error("Erreur lors de l'activation du scanner :",e),alert("Impossible d'accéder à la caméra. Veuillez vérifier les permissions.")}},async analyzeImage(){if(!this.imageFile)return;const e=new FormData;e.append("image",this.imageFile);try{this.isLoading=!0;const t=await T.A.post("https://www.cookaller.com/users/analyzeImage",e,{headers:{"Content-Type":"multipart/form-data"}});t.data&&t.data.data?this.analysisResult=t.data.data.map((e=>({...e,selected:!1,quantity:"",unit:""}))):(this.analysisResult=[],alert("Aucun ingrédient trouvé dans l'image.")),this.showModal=!0}catch(t){console.error("Erreur lors de l'analyse de l'image :",t),alert("Une erreur est survenue lors de l'analyse de l'image.")}finally{this.isLoading=!1}},async validateSelection(){this.showModal=!1;const e=this.analysisResult.filter((e=>e.selected&&e.quantity)),t=e.filter((e=>!e.quantity||parseFloat(e.quantity)<=0));if(t.length>0)this.errorMessage="Veuillez indiquer une quantité valide pour tous les ingrédients sélectionnés.";else{this.errorMessage="";for(const t of e){const e=this.ingredients.findIndex((e=>e.name.toLowerCase()===t.name.toLowerCase()&&e.quantity.includes(t.unit)));if(-1!==e){const n=this.ingredients[e],a=n.quantity,s=a.match(/^([\d.]+)\s*(.*)$/);if(s){const n=parseFloat(s[1]),a=s[2],l=n+parseFloat(t.quantity);this.ingredients[e].quantity=`${l} ${a}`.trim();try{await T.A.put("https://www.cookaller.com/users/fridge/update",{foodName:t.name,quantity:l,unit:a},{withCredentials:!0})}catch(i){console.error(`Erreur lors de la mise à jour de ${t.name} dans la base de données :`,i)}}}else{this.ingredients.push({name:t.name,quantity:`${t.quantity} ${t.unit}`.trim(),category:"ajoutés",updateQuantity:0});try{await T.A.post("https://www.cookaller.com/users/fridge/add",{foodName:t.name,quantity:`${t.quantity} ${t.unit}`.trim()},{withCredentials:!0})}catch(i){console.error(`Erreur lors de l'ajout de ${t.name} dans la base de données :`,i)}}}this.analysisResult=[],this.$emit("ingredients-updated",this.ingredients)}},async fetchIngredientsFromFridge(){try{this.isLoading=!0;const e=await T.A.get("https://www.cookaller.com/users/fridge",{withCredentials:!0});this.ingredients=e.data.map((e=>({name:e.food_name,quantity:e.quantity,category:e.category||"autres",updateQuantity:0})))}catch(e){console.error("Erreur lors de la récupération des ingrédients :",e)}finally{this.isLoading=!1}},async addIngredient(){const e=this.newIngredient.trim();let t=e;if(/\d/.test(t))alert("Le nom de l'ingrédient ne peut pas contenir de chiffres. Veuillez entrer un aliment valide.");else{if(t){const e=this.ingredients.findIndex((e=>e.name===t&&e.quantity.includes(this.newUnit)));if(-1!==e){const n=this.ingredients[e],a=n.quantity,s=a.match(/^([\d.]+)\s*(.*)$/);if(!s)return void alert("Impossible de traiter la quantité actuelle.");const l=parseFloat(s[1]),r=s[2],o=parseFloat(this.newQuantity)||1,d=l+o;try{const i=await T.A.put("https://www.cookaller.com/users/fridge/update",{foodName:t,quantity:d,unit:r},{withCredentials:!0});if(200!==i.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${d} ${r}`.trim()}catch(i){return void console.error("Erreur lors de la mise à jour de l'aliment :",i)}}else try{const e=await T.A.post("https://www.cookaller.com/users/fridge/add",{foodName:t,quantity:`${this.newQuantity||1} ${this.newUnit}`.trim()},{withCredentials:!0});if(200!==e.status)throw new Error("Erreur lors de l'ajout de l'aliment dans le réfrigérateur de l'utilisateur.");await this.fetchIngredientsFromFridge()}catch(i){i.response&&404===i.response.status?alert("L'aliment n'est pas encore dans la base de données."):console.error("Erreur lors de l'ajout de l'aliment :",i)}}this.newIngredient="",this.newQuantity="",this.newUnit="",this.$emit("ingredients-updated",this.ingredients)}},async updateIngredientQuantity(e,t,i,n){if(!i||i<=0)return void alert("Veuillez entrer une quantité valide.");const a=this.ingredients[e].quantity,s=a.match(/^([\d.]+)\s*(.*)$/);if(!s)return void alert("Impossible de traiter la quantité actuelle.");const l=parseFloat(s[1]),r=s[2];let o;if("add"===n)o=l+i;else if("subtract"===n&&(o=l-i,o<=0))return void alert("La quantité ne peut pas être inférieure ou égale à zéro.");try{const i=await T.A.put("https://www.cookaller.com/users/fridge/update",{foodName:t,quantity:o,unit:r},{withCredentials:!0});if(200!==i.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${o} ${r}`.trim()}catch(d){console.error("Erreur lors de la mise à jour de l'aliment :",d)}},async removeIngredient(e,t){try{const i=await T.A.delete("https://www.cookaller.com/users/fridge/delete",{params:{foodName:t},withCredentials:!0});if(200!==i.status)throw new Error("Erreur lors de la suppression de l'aliment du réfrigérateur de l'utilisateur.");this.ingredients.splice(e,1),this.$emit("ingredients-updated",this.ingredients)}catch(i){console.error("Erreur lors de la suppression de l'aliment :",i)}},sortIngredientsByCategory(){this.sortByCategory=!this.sortByCategory},closeModal(){this.showModal=!1}}},Y=i(1241);const Z=(0,Y.A)(W,[["render",H],["__scopeId","data-v-8075dd26"]]);var ee=Z}}]);
//# sourceMappingURL=865.f781a6cf.js.map