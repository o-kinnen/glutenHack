"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[91],{1091:function(e,t,n){n.r(t),n.d(t,{default:function(){return te}});var i=n(6768),a=n(5130),s=n(4232);const l={class:"container"},r={class:"card p-4 text-white"},o={class:"camera-container d-flex flex-column justify-content-center align-items-center"},d={class:"input-text"},u=["disabled"],c={class:"input-container"},p=["disabled"],g=["disabled"],m={class:"modal-actions-icons"},h={class:"upload-container"},y={key:0,class:"image-preview"},k=["src"],v=["disabled"],L={key:0,class:"loading-spinner"},w={class:"search-container"},b={key:1,class:"empty-message"},f={key:2,class:"modal-overlay"},C={class:"modal-content"},I={key:0,class:"analysis-results"},q={class:"analysis-grid"},E=["onUpdate:modelValue"],Q=["onUpdate:modelValue"],U={key:0,class:"error-message"},F=["onUpdate:modelValue"],A={key:3,class:"ingredient-list"},$={class:"category-title"},j={class:"ingredient-info"},x={class:"ingredient-quantity"},V={class:"ingredient-actions"},X=["onUpdate:modelValue"],M={class:"modal-actions-icons"},z=["onClick"],S=["onClick"],R=["onClick"],_={key:4,class:"ingredient-list"},N={class:"ingredient-info"},B={class:"ingredient-quantity"},D={class:"ingredient-actions"},J=["onUpdate:modelValue"],K={class:"modal-actions-icons"},O=["onClick"],P=["onClick"],H=["onClick"];function T(e,t,n,T,G,W){return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("div",r,[t[22]||(t[22]=(0,i.Lk)("h1",null,"Ingrédients en stock ",-1)),t[23]||(t[23]=(0,i.Lk)("p",null,"Entrez un ingrédient ou un code-barres pour l'ajouter à votre stock.",-1)),(0,i.Lk)("div",o,[t[10]||(t[10]=(0,i.Lk)("video",{id:"scanner",class:"camera-feed"},null,-1)),(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>W.activerScanner&&W.activerScanner(...e)),class:"btn btn-secondary mt-2"},"Scanner")]),t[24]||(t[24]=(0,i.Lk)("br",null,null,-1)),(0,i.Lk)("div",d,[(0,i.bo)((0,i.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>G.newIngredient=e),placeholder:"Ingrédient ou code-barres",disabled:G.isLoading},null,8,u),[[a.Jo,G.newIngredient]])]),(0,i.Lk)("div",c,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>G.newQuantity=e),type:"number",min:"1",placeholder:"Quantité",disabled:G.isLoading,class:"quantity-input"},null,8,p),[[a.Jo,G.newQuantity]]),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>G.newUnit=e),disabled:G.isLoading},t[11]||(t[11]=[(0,i.Fv)('<option value="" data-v-b0ad14ea>Unités</option><option value="g" data-v-b0ad14ea>g</option><option value="kg" data-v-b0ad14ea>kg</option><option value="ml" data-v-b0ad14ea>ml</option><option value="l" data-v-b0ad14ea>l</option>',5)]),8,g),[[a.u1,G.newUnit]]),(0,i.Lk)("div",m,[(0,i.Lk)("i",{class:"bi bi-plus-circle-fill icon-action",onClick:t[4]||(t[4]=(...e)=>W.addIngredient&&W.addIngredient(...e)),title:"Ajouter"})])]),(0,i.Lk)("div",h,[t[12]||(t[12]=(0,i.Lk)("h5",null,"Uploader une photo :",-1)),(0,i.Lk)("input",{type:"file",onChange:t[5]||(t[5]=(...e)=>W.onFileChange&&W.onFileChange(...e)),accept:"image/*"},null,32),G.imageUrl?((0,i.uX)(),(0,i.CE)("div",y,[(0,i.Lk)("img",{src:G.imageUrl,alt:"Aperçu de l'image"},null,8,k)])):(0,i.Q3)("",!0)]),(0,i.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>W.analyzeImage&&W.analyzeImage(...e)),disabled:!G.imageFile||G.isLoading,class:"analyze-button"},"Analyser",8,v),G.isLoading?((0,i.uX)(),(0,i.CE)("div",L,"Chargement...")):(0,i.Q3)("",!0),(0,i.Lk)("div",w,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>G.searchIngredient=e),placeholder:"Rechercher"},null,512),[[a.Jo,G.searchIngredient]])]),t[25]||(t[25]=(0,i.Lk)("br",null,null,-1)),0===G.ingredients.length?((0,i.uX)(),(0,i.CE)("div",b," La liste des ingrédients est vide... ")):(0,i.Q3)("",!0),G.showModal?((0,i.uX)(),(0,i.CE)("div",f,[(0,i.Lk)("div",C,[(0,i.Lk)("button",{class:"close-btn",onClick:t[8]||(t[8]=(...e)=>W.closeModal&&W.closeModal(...e))},"X"),G.analysisResult.length>0?((0,i.uX)(),(0,i.CE)("div",I,[t[15]||(t[15]=(0,i.Lk)("h5",null,"Résultats de l'analyse :",-1)),(0,i.Lk)("div",q,[t[14]||(t[14]=(0,i.Lk)("div",{class:"grid-header"},[(0,i.Lk)("span",null,"Sélection"),(0,i.Lk)("span",null,"Aliment"),(0,i.Lk)("span",null,"Probabilité"),(0,i.Lk)("span",null,"Quantité"),(0,i.Lk)("span",null,"Unités")],-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(G.analysisResult,((e,n)=>((0,i.uX)(),(0,i.CE)("div",{key:n,class:"grid-row"},[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.selected=t},null,8,E),[[a.lH,e.selected]]),(0,i.Lk)("span",null,(0,s.v_)(e.name),1),(0,i.Lk)("span",null,(0,s.v_)((100*e.probability).toFixed(2))+"%",1),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t=>e.quantity=t,type:"number",min:"1",placeholder:"Quantité",class:(0,s.C4)(["quantity-input",{error:e.selected&&(!e.quantity||parseFloat(e.quantity)<=0)}])},null,10,Q),[[a.Jo,e.quantity]]),G.errorMessage?((0,i.uX)(),(0,i.CE)("div",U,(0,s.v_)(G.errorMessage),1)):(0,i.Q3)("",!0),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t=>e.unit=t,class:"unit-select"},t[13]||(t[13]=[(0,i.Fv)('<option value="" data-v-b0ad14ea>Unités</option><option value="g" data-v-b0ad14ea>g</option><option value="ml" data-v-b0ad14ea>ml</option><option value="kg" data-v-b0ad14ea>kg</option><option value="l" data-v-b0ad14ea>l</option>',5)]),8,F),[[a.u1,e.unit]])])))),128))]),(0,i.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>W.validateSelection&&W.validateSelection(...e)),class:"button align-center"},"Ajouter")])):(0,i.Q3)("",!0)])])):(0,i.Q3)("",!0),G.sortByCategory?((0,i.uX)(),(0,i.CE)("div",A,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(W.categorizedIngredients,((e,n)=>((0,i.uX)(),(0,i.CE)("div",{key:n,class:"category-group"},[(0,i.Lk)("h5",$,(0,s.v_)(n),1),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e,((e,n)=>((0,i.uX)(),(0,i.CE)("li",{key:n,class:"ingredient-item"},[(0,i.Lk)("div",j,[(0,i.Lk)("strong",null,(0,s.v_)(e.name),1),(0,i.Lk)("div",x,(0,s.v_)(e.quantity),1)]),(0,i.Lk)("div",V,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité",class:"quantity-input"},null,8,X),[[a.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,i.Lk)("div",M,[(0,i.Lk)("i",{class:"bi bi-plus-circle-fill icon-action",onClick:t=>W.updateIngredientQuantity(n,e.name,e.updateQuantity,"add"),title:"Ajouter"},null,8,z),t[16]||(t[16]=(0,i.Lk)("span",{class:"tooltip-text"},"Ajouter",-1)),(0,i.Lk)("i",{class:"bi bi-dash-circle-fill icon-action",onClick:t=>W.updateIngredientQuantity(n,e.name,e.updateQuantity,"subtract"),title:"Diminuer"},null,8,S),t[17]||(t[17]=(0,i.Lk)("span",{class:"tooltip-text"},"Diminuer",-1)),(0,i.Lk)("i",{class:"bi bi-trash-fill icon-action",onClick:t=>W.removeIngredient(n,e.name),title:"Supprimer"},null,8,R),t[18]||(t[18]=(0,i.Lk)("span",{class:"tooltip-text"},"Supprimer",-1))])])])))),128))])])))),128))])):((0,i.uX)(),(0,i.CE)("div",_,[(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(W.filteredIngredients,((e,n)=>((0,i.uX)(),(0,i.CE)("li",{key:n,class:"ingredient-item"},[(0,i.Lk)("div",N,[(0,i.Lk)("strong",null,(0,s.v_)(e.name),1),(0,i.Lk)("div",B,[(0,i.Lk)("strong",null,"("+(0,s.v_)(e.quantity)+")",1)])]),(0,i.Lk)("div",D,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t=>e.updateQuantity=t,type:"number",min:"1",placeholder:"Quantité",class:"quantity-input"},null,8,J),[[a.Jo,e.updateQuantity,void 0,{number:!0}]]),(0,i.Lk)("div",K,[(0,i.Lk)("i",{class:"bi bi-plus-circle-fill icon-action",onClick:t=>W.updateIngredientQuantity(n,e.name,e.updateQuantity,"add"),title:"Ajouter"},null,8,O),t[19]||(t[19]=(0,i.Lk)("span",{class:"tooltip-text"},"Ajouter",-1)),(0,i.Lk)("i",{class:"bi bi-dash-circle-fill icon-action",onClick:t=>W.updateIngredientQuantity(n,e.name,e.updateQuantity,"subtract"),title:"Diminuer"},null,8,P),t[20]||(t[20]=(0,i.Lk)("span",{class:"tooltip-text"},"Diminuer",-1)),(0,i.Lk)("i",{class:"bi bi-trash-fill icon-action",onClick:t=>W.removeIngredient(n,e.name),title:"Supprimer"},null,8,H),t[21]||(t[21]=(0,i.Lk)("span",{class:"tooltip-text"},"Supprimer",-1))])])])))),128))])]))])])}n(4114),n(4603),n(7566),n(8721);var G=n(4373),W=n(2295),Y={name:"IngredientsPage.vue",data(){return{newIngredient:"",newQuantity:"",newUnit:"",searchIngredient:"",ingredients:[],imageFile:null,imageUrl:"",analysisResult:[],isLoading:!1,sortByCategory:!1,errorMessage:"",showModal:!1,scanner:null,scannerActive:!1}},computed:{filteredIngredients(){let e=this.ingredients;return""!==this.searchIngredient.trim()&&(e=e.filter((e=>e.name.toLowerCase().includes(this.searchIngredient.trim().toLowerCase())))),e},categorizedIngredients(){const e={};return this.filteredIngredients.forEach((t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)})),e}},created(){this.fetchIngredientsFromFridge()},methods:{onFileChange(e){const t=e.target.files[0];t&&(this.imageFile=t,this.imageUrl=URL.createObjectURL(t))},async activerScanner(){try{this.scanner=new W.sx;const e={video:{facingMode:{exact:"environment"}}},t=document.getElementById("scanner"),n=await this.scanner.decodeOnceFromVideoDevice(null,t,e);n&&(this.ingredientName=n.text,console.log(this.ingredientName),this.addIngredient())}catch(e){console.error("Erreur lors de l'activation du scanner :",e),alert("Impossible d'accéder à la caméra. Veuillez vérifier les permissions.")}},async analyzeImage(){if(!this.imageFile)return;const e=new FormData;e.append("image",this.imageFile);try{this.isLoading=!0;const t=await G.A.post("https://www.cookaller.com/users/analyzeImage",e,{headers:{"Content-Type":"multipart/form-data"}});t.data&&t.data.data?this.analysisResult=t.data.data.map((e=>({...e,selected:!1,quantity:"",unit:""}))):(this.analysisResult=[],alert("Aucun ingrédient trouvé dans l'image.")),this.showModal=!0}catch(t){console.error("Erreur lors de l'analyse de l'image :",t),alert("Une erreur est survenue lors de l'analyse de l'image.")}finally{this.isLoading=!1}},async validateSelection(){this.showModal=!1;const e=this.analysisResult.filter((e=>e.selected&&e.quantity)),t=e.filter((e=>!e.quantity||parseFloat(e.quantity)<=0));if(t.length>0)this.errorMessage="Veuillez indiquer une quantité valide pour tous les ingrédients sélectionnés.";else{this.errorMessage="";for(const t of e){const e=this.ingredients.findIndex((e=>e.name.toLowerCase()===t.name.toLowerCase()&&e.quantity.includes(t.unit)));if(-1!==e){const i=this.ingredients[e],a=i.quantity,s=a.match(/^([\d.]+)\s*(.*)$/);if(s){const i=parseFloat(s[1]),a=s[2],l=i+parseFloat(t.quantity);this.ingredients[e].quantity=`${l} ${a}`.trim();try{await G.A.put("https://www.cookaller.com/users/fridge/update",{foodName:t.name,quantity:l,unit:a},{withCredentials:!0})}catch(n){console.error(`Erreur lors de la mise à jour de ${t.name} dans la base de données :`,n)}}}else{this.ingredients.push({name:t.name,quantity:`${t.quantity} ${t.unit}`.trim(),category:"ajoutés",updateQuantity:0});try{await G.A.post("https://www.cookaller.com/users/fridge/add",{foodName:t.name,quantity:`${t.quantity} ${t.unit}`.trim()},{withCredentials:!0})}catch(n){console.error(`Erreur lors de l'ajout de ${t.name} dans la base de données :`,n)}}}this.analysisResult=[],this.$emit("ingredients-updated",this.ingredients)}},async fetchIngredientsFromFridge(){try{this.isLoading=!0;const e=await G.A.get("https://www.cookaller.com/users/fridge",{withCredentials:!0});this.ingredients=e.data.map((e=>({name:e.food_name,quantity:e.quantity,category:e.category||"autres",updateQuantity:0})))}catch(e){console.error("Erreur lors de la récupération des ingrédients :",e)}finally{this.isLoading=!1}},async addIngredient(){const e=this.newIngredient.trim();let t=e;if(t){const e=this.ingredients.findIndex((e=>e.name===t&&e.quantity.includes(this.newUnit)));if(-1!==e){const i=this.ingredients[e],a=i.quantity,s=a.match(/^([\d.]+)\s*(.*)$/);if(!s)return void alert("Impossible de traiter la quantité actuelle.");const l=parseFloat(s[1]),r=s[2],o=parseFloat(this.newQuantity)||1,d=l+o;try{const n=await G.A.put("https://www.cookaller.com/users/fridge/update",{foodName:t,quantity:d,unit:r},{withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${d} ${r}`.trim()}catch(n){return void console.error("Erreur lors de la mise à jour de l'aliment :",n)}}else try{const e=await G.A.post("https://www.cookaller.com/users/fridge/add",{foodName:t,quantity:`${this.newQuantity||1} ${this.newUnit}`.trim()},{withCredentials:!0});if(200!==e.status)throw new Error("Erreur lors de l'ajout de l'aliment dans le réfrigérateur de l'utilisateur.");await this.fetchIngredientsFromFridge()}catch(n){n.response&&404===n.response.status?alert("L'aliment n'est pas encore dans la base de données."):console.error("Erreur lors de l'ajout de l'aliment :",n)}}this.newIngredient="",this.newQuantity="",this.newUnit="",this.$emit("ingredients-updated",this.ingredients)},async updateIngredientQuantity(e,t,n,i){if(!n||n<=0)return void alert("Veuillez entrer une quantité valide.");const a=this.ingredients[e].quantity,s=a.match(/^([\d.]+)\s*(.*)$/);if(!s)return void alert("Impossible de traiter la quantité actuelle.");const l=parseFloat(s[1]),r=s[2];let o;if("add"===i)o=l+n;else if("subtract"===i&&(o=l-n,o<=0))return void alert("La quantité ne peut pas être inférieure ou égale à zéro.");try{const n=await G.A.put("https://www.cookaller.com/users/fridge/update",{foodName:t,quantity:o,unit:r},{withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la mise à jour de l'aliment dans le réfrigérateur de l'utilisateur.");this.ingredients[e].quantity=`${o} ${r}`.trim()}catch(d){console.error("Erreur lors de la mise à jour de l'aliment :",d)}},async removeIngredient(e,t){try{const n=await G.A.delete("https://www.cookaller.com/users/fridge/delete",{params:{foodName:t},withCredentials:!0});if(200!==n.status)throw new Error("Erreur lors de la suppression de l'aliment du réfrigérateur de l'utilisateur.");this.ingredients.splice(e,1),this.$emit("ingredients-updated",this.ingredients)}catch(n){console.error("Erreur lors de la suppression de l'aliment :",n)}},sortIngredientsByCategory(){this.sortByCategory=!this.sortByCategory},closeModal(){this.showModal=!1}}},Z=n(1241);const ee=(0,Z.A)(Y,[["render",T],["__scopeId","data-v-b0ad14ea"]]);var te=ee}}]);
//# sourceMappingURL=91.864bbb99.js.map