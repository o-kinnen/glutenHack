"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[994],{994:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var r=s(6768),o=s(4232),n=s(5130);const l={class:"container mt-5 text-center"},a={class:"card p-4 bg-dark text-white"},i={class:"mt-4"},c={key:0,class:"modal-overlay"},u={class:"modal-content"},d={class:"checkbox-group"},m=["onUpdate:modelValue"];function p(e,t,s,p,h,f){return(0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",a,[(0,r.Lk)("h2",null,"Bienvenue "+(0,o.v_)(h.username)+" !",1),(0,r.Lk)("p",null,[t[5]||(t[5]=(0,r.eW)("Votre adresse mail : ")),(0,r.Lk)("strong",null,(0,o.v_)(h.email),1)]),(0,r.Lk)("p",null,[t[6]||(t[6]=(0,r.eW)("Vos allergènes : ")),(0,r.Lk)("strong",null,(0,o.v_)(f.selectedRestrictionsText),1)]),(0,r.Lk)("div",i,[(0,r.Lk)("button",{class:"btn btn-primary mb-2",onClick:t[0]||(t[0]=(...e)=>f.modifyProfile&&f.modifyProfile(...e))},"Modifier le profil"),t[7]||(t[7]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("button",{class:"btn btn-secondary mb-2",onClick:t[1]||(t[1]=(...e)=>f.logout&&f.logout(...e))},"Se déconnecter"),t[8]||(t[8]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("button",{class:"btn btn-danger",onClick:t[2]||(t[2]=(...e)=>f.deleteAccount&&f.deleteAccount(...e))},"Supprimer le compte")])]),h.showModal?((0,r.uX)(),(0,r.CE)("div",c,[(0,r.Lk)("div",u,[t[10]||(t[10]=(0,r.Lk)("h2",null,"Mes allergènes",-1)),(0,r.Lk)("form",{onSubmit:t[4]||(t[4]=(0,n.D$)(((...e)=>f.submitForm&&f.submitForm(...e)),["prevent"]))},[(0,r.Lk)("div",d,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(h.restrictions,(e=>((0,r.uX)(),(0,r.CE)("label",{key:e.name},[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.selected=t},null,8,m),[[n.lH,e.selected]]),(0,r.eW)(" "+(0,o.v_)(e.name),1)])))),128))]),t[9]||(t[9]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"Confirmer",-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[3]||(t[3]=e=>h.showModal=!1)},"Fermer")],32)])])):(0,r.Q3)("",!0)])}s(4114);var h={name:"ProfilePage",data(){return{username:"",email:"",userId:null,showModal:!1,restrictions:[{name:"Lactose",selected:!1},{name:"Gluten",selected:!1},{name:"Arachide",selected:!1},{name:"Oeuf",selected:!1}]}},computed:{selectedRestrictionsText(){const e=this.restrictions.filter((e=>e.selected)).map((e=>e.name));return e.length?e.join(", "):"aucune"}},methods:{async fetchProfile(){try{const e=await fetch("https://tfe-3483aa964321.herokuapp.com/users/profile",{credentials:"include"}),t=await e.json();e.ok?(this.username=t.username,this.email=t.email,this.userId=t.user_id,this.updatePreferencesFromProfile(t.restrictions)):(this.errorMessage=t.message||"Erreur lors de la récupération des informations du profil.",this.$router.push("/login"))}catch(e){this.errorMessage="Erreur lors de la communication avec le serveur. Veuillez réessayer plus tard."}},updatePreferencesFromProfile(e){this.restrictions.forEach((t=>{t.selected=e.includes(t.name)}))},modifyProfile(){this.showModal=!0},async submitForm(){const e=this.restrictions.filter((e=>e.selected)).map((e=>e.name));try{const t=await fetch(`https://tfe-3483aa964321.herokuapp.com/users/update-preferences/${this.userId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({restrictions:e}),credentials:"include"});t.ok?(this.showModal=!1,await this.fetchProfile()):console.error("Erreur lors de la mise à jour des préférences.")}catch(t){console.error("Erreur:",t)}},async logout(){try{const e=await fetch("https://tfe-3483aa964321.herokuapp.com/users/logout",{method:"POST",credentials:"include"});e.ok?(this.$store.dispatch("logout"),this.$router.push("/login")):this.errorMessage="Erreur lors de la déconnexion."}catch(e){this.errorMessage="Erreur lors de la déconnexion."}},async deleteAccount(){if(confirm("Êtes-vous sûr de vouloir supprimer votre compte ? Les recettes publiques seront conservées en anonyme et seules les recettes privées seront supprimées."))try{const e=await fetch("https://tfe-3483aa964321.herokuapp.com/users/delete",{method:"DELETE",credentials:"include"});e.ok?(alert("Votre compte a été supprimé avec succès."),this.$store.dispatch("logout"),this.$router.push("/")):this.errorMessage="Erreur lors de la suppression du compte."}catch(e){this.errorMessage="Erreur lors de la suppression du compte."}}},created(){this.fetchProfile()}},f=s(1241);const k=(0,f.A)(h,[["render",p],["__scopeId","data-v-36f05840"]]);var b=k}}]);
//# sourceMappingURL=994.2c1b72e1.js.map