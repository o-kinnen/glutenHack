{"version":3,"file":"js/994.2c1b72e1.js","mappings":"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","sources":["webpack://frontend/./src/views/ProfilePage.vue","webpack://frontend/./src/views/ProfilePage.vue?ccbe"],"sourcesContent":["<template>\r\n    <div class=\"container mt-5 text-center\">\r\n      <div class=\"card p-4 bg-dark text-white\">\r\n        <h2>Bienvenue {{ username }} !</h2>\r\n        <p>Votre adresse mail : <strong>{{ email }}</strong></p>\r\n        <p>Vos allergènes : <strong>{{ selectedRestrictionsText }}</strong></p>\r\n        <div class=\"mt-4\">\r\n          <button class=\"btn btn-primary mb-2\" @click=\"modifyProfile\">Modifier le profil</button><br>\r\n          <button class=\"btn btn-secondary mb-2\" @click=\"logout\">Se déconnecter</button><br>\r\n          <button class=\"btn btn-danger\" @click=\"deleteAccount\">Supprimer le compte</button>\r\n        </div>\r\n      </div>\r\n    <div v-if=\"showModal\" class=\"modal-overlay\">\r\n      <div class=\"modal-content\">\r\n        <h2>Mes allergènes</h2>\r\n        <form @submit.prevent=\"submitForm\">\r\n          <div class=\"checkbox-group\">\r\n            <label v-for=\"restriction in restrictions\" :key=\"restriction.name\">\r\n              <input\r\n                type=\"checkbox\"\r\n                v-model=\"restriction.selected\"\r\n              />\r\n              {{ restriction.name }}\r\n            </label>\r\n          </div>\r\n          <button type=\"submit\" class=\"btn btn-primary\">Confirmer</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" @click=\"showModal = false\">Fermer</button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n  \r\n<script>\r\nexport default {\r\n  name: 'ProfilePage',\r\n  data() {\r\n    return {\r\n      username: '',\r\n      email: '',\r\n      userId: null,\r\n      showModal: false,\r\n      restrictions: [\r\n        { name: \"Lactose\", selected: false },\r\n        { name: \"Gluten\", selected: false },\r\n        { name: \"Arachide\", selected: false },\r\n        { name: \"Oeuf\", selected: false }\r\n      ]\r\n    };\r\n  },\r\n  computed: {\r\n    selectedRestrictionsText() {\r\n      const selectedRestrictions = this.restrictions\r\n        .filter(item => item.selected)\r\n        .map(item => item.name);\r\n      return selectedRestrictions.length ? selectedRestrictions.join(\", \") : \"aucune\";\r\n    }\r\n  },\r\n  methods: {\r\n    async fetchProfile() {\r\n      try {\r\n        const response = await fetch(`${process.env.VUE_APP_URL_BACKEND}/users/profile`, {\r\n          credentials: 'include',\r\n        });\r\n        const data = await response.json();\r\n        if (response.ok) {\r\n          this.username = data.username;\r\n          this.email = data.email;\r\n          this.userId = data.user_id;\r\n          this.updatePreferencesFromProfile(data.restrictions);\r\n        } else {\r\n          this.errorMessage = data.message || 'Erreur lors de la récupération des informations du profil.';\r\n          this.$router.push('/login');\r\n        }\r\n      } catch (error) {\r\n        this.errorMessage = 'Erreur lors de la communication avec le serveur. Veuillez réessayer plus tard.';\r\n      }\r\n    },\r\n    updatePreferencesFromProfile(restrictions) {\r\n      this.restrictions.forEach(restriction => {\r\n        restriction.selected = restrictions.includes(restriction.name);\r\n      });\r\n    },\r\n    modifyProfile() {\r\n      this.showModal = true;\r\n    },\r\n    async submitForm() {\r\n      const selectedRestrictions = this.restrictions.filter(item => item.selected).map(item => item.name);\r\n  \r\n      try {\r\n        const response = await fetch(`${process.env.VUE_APP_URL_BACKEND}/users/update-preferences/${this.userId}`, {\r\n          method: 'PUT',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ restrictions: selectedRestrictions}),\r\n          credentials: 'include',\r\n        });\r\n  \r\n        if (response.ok) {\r\n          this.showModal = false;\r\n          await this.fetchProfile();\r\n        } else {\r\n          console.error('Erreur lors de la mise à jour des préférences.');\r\n        }\r\n      } catch (error) {\r\n        console.error('Erreur:', error);\r\n      }\r\n    },\r\n    async logout() {\r\n      try {\r\n        const response = await fetch(`${process.env.VUE_APP_URL_BACKEND}/users/logout`, {\r\n          method: 'POST',\r\n          credentials: 'include',\r\n        });\r\n        if (response.ok) {\r\n          this.$store.dispatch('logout');\r\n          this.$router.push('/login');\r\n        } else {\r\n          this.errorMessage = 'Erreur lors de la déconnexion.';\r\n        }\r\n      } catch (error) {\r\n        this.errorMessage = 'Erreur lors de la déconnexion.';\r\n      }\r\n    },\r\n    async deleteAccount() {\r\n      if (confirm('Êtes-vous sûr de vouloir supprimer votre compte ? Les recettes publiques seront conservées en anonyme et seules les recettes privées seront supprimées.')) {\r\n        try {\r\n          const response = await fetch(`${process.env.VUE_APP_URL_BACKEND}/users/delete`, {\r\n            method: 'DELETE',\r\n            credentials: 'include',\r\n          });\r\n          if (response.ok) {\r\n            alert('Votre compte a été supprimé avec succès.');\r\n            this.$store.dispatch('logout');\r\n            this.$router.push('/');\r\n          } else {\r\n            this.errorMessage = 'Erreur lors de la suppression du compte.';\r\n          }\r\n        } catch (error) {\r\n          this.errorMessage = 'Erreur lors de la suppression du compte.';\r\n        }\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    this.fetchProfile();\r\n  },\r\n};\r\n</script>\r\n  \r\n<style scoped>\r\n.container {\r\n  max-width: 600px;\r\n}\r\n.card {\r\n  border-radius: 15px;\r\n}\r\n.modal-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n.modal-content {\r\n  background-color: #333;\r\n  color: #fff;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  max-width: 400px;\r\n  width: 100%;\r\n}\r\n.checkbox-group {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-bottom: 20px;\r\n}\r\n.section {\r\n  text-align: left;\r\n}\r\nbutton {\r\n  margin-top: 10px;\r\n}\r\n</style>\r\n  ","import { render } from \"./ProfilePage.vue?vue&type=template&id=36f05840&scoped=true\"\nimport script from \"./ProfilePage.vue?vue&type=script&lang=js\"\nexport * from \"./ProfilePage.vue?vue&type=script&lang=js\"\n\nimport \"./ProfilePage.vue?vue&type=style&index=0&id=36f05840&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-36f05840\"]])\n\nexport default __exports__"],"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_toDisplayString","$data","username","_createTextVNode","email","$options","selectedRestrictionsText","_hoisted_3","onClick","_cache","args","modifyProfile","logout","deleteAccount","showModal","_hoisted_4","_hoisted_5","onSubmit","_withModifiers","submitForm","_hoisted_6","_Fragment","_renderList","restrictions","restriction","name","type","$event","selected","_hoisted_7","_createCommentVNode","data","userId","computed","selectedRestrictions","this","filter","item","map","length","join","methods","fetchProfile","response","fetch","credentials","json","ok","user_id","updatePreferencesFromProfile","errorMessage","message","$router","push","error","forEach","includes","method","headers","body","JSON","stringify","console","$store","dispatch","confirm","alert","created","__exports__","render"],"sourceRoot":""}